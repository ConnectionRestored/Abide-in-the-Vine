/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __markAsModule = (target) => __defProp(target, "__esModule", { value: true });
var __export = (target, all) => {
  __markAsModule(target);
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __reExport = (target, module2, desc) => {
  if (module2 && typeof module2 === "object" || typeof module2 === "function") {
    for (let key of __getOwnPropNames(module2))
      if (!__hasOwnProp.call(target, key) && key !== "default")
        __defProp(target, key, { get: () => module2[key], enumerable: !(desc = __getOwnPropDesc(module2, key)) || desc.enumerable });
  }
  return target;
};
var __toModule = (module2) => {
  return __reExport(__markAsModule(__defProp(module2 != null ? __create(__getProtoOf(module2)) : {}, "default", module2 && module2.__esModule && "default" in module2 ? { get: () => module2.default, enumerable: true } : { value: module2, enumerable: true })), module2);
};
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
__export(exports, {
  default: () => BibleLinkerPlugin
});
var import_obsidian7 = __toModule(require("obsidian"));

// src/modals/copy-verse-modal.ts
var import_obsidian3 = __toModule(require("obsidian"));

// src/logic/copy-command.ts
var import_obsidian2 = __toModule(require("obsidian"));

// src/utils/regexes.ts
var oneVerseRegEx = new RegExp(/([^,:#]+)[,#.:;]\s*(\d+)\s*$/);
var multipleVersesRegEx = new RegExp(/([^,:#]+)[,#.:;]\s*(\d+)\s*[-.=]\s*(\d+)\s*$/);
var bookAndChapterRegexForOBSK = /([^,:#]+)\s(\d+)/;
var multipleChapters = /(\d*[^\d,:#]+)\s*(\d+)\s*-\s*(\d+)\s*$/;
var isOBSKFile = /([a-zA-Z0-9 ]+)-(\d{2,3})/;

// src/logic/common.ts
var import_obsidian = __toModule(require("obsidian"));
function capitalize(str) {
  str = str.toLocaleLowerCase();
  for (let i = 0; i < str.length; i++) {
    if (/[^\s\d.,#-]/.test(str.charAt(i))) {
      return str.slice(0, i) + str.charAt(i).toUpperCase() + str.slice(i + 1);
    }
  }
  return str;
}
function parseUserVerseInput(userInput, verbose = true) {
  let bookAndChapter;
  let beginVerse;
  let endVerse;
  switch (true) {
    case oneVerseRegEx.test(userInput): {
      const [, matchedChapter, matchedVerse] = userInput.match(oneVerseRegEx);
      bookAndChapter = matchedChapter;
      beginVerse = Number(matchedVerse);
      endVerse = Number(matchedVerse);
      break;
    }
    case multipleVersesRegEx.test(userInput): {
      const [, matchedChapter, matchedBeginVerse, matchedEndVerse] = userInput.match(multipleVersesRegEx);
      bookAndChapter = matchedChapter;
      beginVerse = Number(matchedBeginVerse);
      endVerse = Number(matchedEndVerse);
      break;
    }
    default: {
      if (verbose) {
        new import_obsidian.Notice(`Wrong format "${userInput}"`);
      }
      throw "Could not parse user input";
    }
  }
  return { bookAndChapter, beginVerse, endVerse };
}
function parseUserBookInput(userInput) {
  let book;
  let firstChapter;
  let lastChapter;
  switch (true) {
    case multipleChapters.test(userInput): {
      const [, matchedBook, matchedFirstChapter, matchedLastChapter] = userInput.match(multipleChapters);
      book = matchedBook.trim();
      firstChapter = Number(matchedFirstChapter);
      lastChapter = Number(matchedLastChapter);
      break;
    }
    default: {
      new import_obsidian.Notice(`Wrong format "${userInput}"`);
      throw "Could not parse user input";
    }
  }
  return { book, firstChapter, lastChapter };
}
function getFileByFilename(app, filename, path = "/") {
  let filenameCopy = filename;
  let tFile = app.metadataCache.getFirstLinkpathDest(filenameCopy, path);
  if (!tFile) {
    filenameCopy = tryConvertToOBSKFileName(filenameCopy);
    tFile = app.metadataCache.getFirstLinkpathDest(filenameCopy, path);
  }
  return { fileName: filenameCopy, tFile };
}
function tryConvertToOBSKFileName(bookAndChapter) {
  if (bookAndChapterRegexForOBSK.test(bookAndChapter)) {
    let [, book, number] = bookAndChapter.match(bookAndChapterRegexForOBSK);
    if (number.length == 1) {
      number = `0${number}`;
    }
    return `${book}-${number}`;
  }
}

// src/logic/copy-command.ts
function getTextOfVerses(app, userInput, settings, translationPath, verbose = true) {
  return __async(this, null, function* () {
    let { bookAndChapter, beginVerse, endVerse } = parseUserVerseInput(userInput, verbose);
    bookAndChapter = capitalize(bookAndChapter);
    const { fileName, tFile } = getFileByFilename(app, bookAndChapter, translationPath);
    if (tFile) {
      return yield createCopyOutput(app, tFile, fileName, beginVerse, endVerse, settings, translationPath, verbose);
    } else {
      if (verbose) {
        new import_obsidian2.Notice(`File ${bookAndChapter} not found`);
      }
      throw "File not found";
    }
  });
}
function getVerseText(verseNumber, headings, lines, keepNewlines, newLinePrefix) {
  if (verseNumber >= headings.length) {
    new import_obsidian2.Notice("Verse out of range for given file");
    throw `VerseNumber ${verseNumber} is out of range of headings with length ${headings.length}`;
  }
  const headingLine = headings[verseNumber].position.start.line;
  if (headingLine + 1 >= lines.length) {
    new import_obsidian2.Notice("Logical error - please create issue on plugin's GitHub with your input and the file you were referencing. Thank you!");
    throw `HeadingLine ${headingLine + 1} is out of range of lines with length ${lines}`;
  }
  let output = "";
  let line = "";
  let i = 1;
  let isFirst = true;
  while (true) {
    line = lines[headingLine + i];
    if (/^#/.test(line) || !line && !isFirst) {
      break;
    }
    i++;
    if (line) {
      if (!isFirst) {
        output += keepNewlines ? `
${newLinePrefix}` : " ";
      }
      isFirst = false;
      output += line;
    }
  }
  return output;
}
function replaceNewline(input) {
  return input.replace(/\\n/g, "\n");
}
function createBookAndChapterOutput(fileBasename) {
  if (isOBSKFile.test(fileBasename)) {
    let [, filename, chapter] = fileBasename.match(isOBSKFile);
    if (chapter.toString()[0] === "0") {
      chapter = chapter.substring(1);
    }
    return filename + " " + chapter;
  }
  return fileBasename;
}
function getFileFolderInTranslation(app, filename, translation) {
  const tFileInfo = getFileByFilename(app, filename, translation);
  return tFileInfo.tFile.parent.path;
}
function createCopyOutput(app, tFile, fileName, beginVerse, endVerse, settings, translationPath, verbose) {
  return __async(this, null, function* () {
    const bookAndChapterOutput = createBookAndChapterOutput(tFile.basename);
    const file = app.vault.read(tFile);
    const lines = (yield file).split(/\r?\n/);
    const verseHeadingLevel = settings.verseHeadingLevel;
    const headings = app.metadataCache.getFileCache(tFile).headings.filter((heading) => !verseHeadingLevel || heading.level === verseHeadingLevel);
    const beginVerseNoOffset = beginVerse;
    const endVerseNoOffset = endVerse;
    beginVerse += settings.verseOffset;
    endVerse += settings.verseOffset;
    if (beginVerse > endVerse) {
      if (verbose) {
        new import_obsidian2.Notice("Begin verse is bigger than end verse");
      }
      throw "Begin verse is bigger than end verse";
    }
    if (headings.length <= beginVerse) {
      if (verbose) {
        new import_obsidian2.Notice("Begin verse out of range of chapter");
      }
      throw "Begin verse out of range of chapter";
    }
    let res = settings.prefix;
    const postfix = settings.postfix ? replaceNewline(settings.postfix) : " ";
    let pathToUse = "";
    if (settings.enableMultipleTranslations) {
      if (settings.translationLinkingType !== "main")
        pathToUse = getFileFolderInTranslation(app, fileName, translationPath);
      else {
        pathToUse = getFileFolderInTranslation(app, fileName, settings.parsedTranslationPaths.first());
      }
    }
    if (beginVerse === endVerse) {
      res += `[[${pathToUse ? pathToUse + "/" : ""}${fileName}#${headings[beginVerse].heading}|${bookAndChapterOutput}${settings.oneVerseNotation}${beginVerseNoOffset}]]${postfix}`;
    } else if (settings.linkEndVerse) {
      res += `[[${pathToUse ? pathToUse + "/" : ""}${fileName}#${headings[beginVerse].heading}|${bookAndChapterOutput}${settings.multipleVersesNotation}${beginVerseNoOffset}-]]`;
      res += `[[${pathToUse ? pathToUse + "/" : ""}${fileName}#${headings[endVerse].heading}|${endVerseNoOffset}]]${postfix}`;
    } else {
      res += `[[${pathToUse ? pathToUse + "/" : ""}${fileName}#${headings[beginVerse].heading}|${bookAndChapterOutput}${settings.multipleVersesNotation}${beginVerseNoOffset}-${endVerseNoOffset}]]${postfix}`;
    }
    for (let i = beginVerse; i <= endVerse; i++) {
      let versePrefix = "";
      const versePostfix = settings.insertSpace ? " " : "";
      if (settings.eachVersePrefix) {
        versePrefix += settings.eachVersePrefix.replace(/{n}/g, (i - settings.verseOffset).toString());
        versePrefix = versePrefix.replace(/{f}/g, `${fileName}`);
      }
      const verseText = getVerseText(i, headings, lines, settings.newLines, settings.prefix);
      if (settings.newLines) {
        res += "\n" + settings.prefix + versePrefix + verseText;
      } else {
        res += versePrefix + verseText + versePostfix;
      }
    }
    if (!settings.useInvisibleLinks)
      return res;
    if (beginVerse == endVerse && (!settings.enableMultipleTranslations || settings.translationLinkingType === "main" || settings.translationLinkingType === "used"))
      return res;
    if (settings.newLines) {
      res += `
${settings.prefix}`;
    }
    for (let i = beginVerse; i <= endVerse; i++) {
      if (!settings.enableMultipleTranslations) {
        res += `[[${fileName}#${headings[i].heading}|]]`;
      } else {
        let translationPathsToUse = [];
        switch (settings.translationLinkingType) {
          case "all":
            translationPathsToUse = settings.parsedTranslationPaths.map((tr) => getFileFolderInTranslation(app, fileName, tr));
            break;
          case "used":
            translationPathsToUse = [getFileFolderInTranslation(app, fileName, translationPath)];
            break;
          case "usedAndMain":
            if (translationPath !== settings.parsedTranslationPaths.first()) {
              translationPathsToUse = [
                getFileFolderInTranslation(app, fileName, translationPath),
                getFileFolderInTranslation(app, fileName, settings.parsedTranslationPaths.first())
              ];
            } else {
              translationPathsToUse = [getFileFolderInTranslation(app, fileName, translationPath)];
            }
            break;
          case "main":
            translationPathsToUse = [getFileFolderInTranslation(app, fileName, settings.parsedTranslationPaths.first())];
            break;
          default:
            break;
        }
        translationPathsToUse.forEach((translationPath2) => {
          res += `[[${translationPath2}/${fileName}#${headings[i].heading}|]]`;
        });
      }
    }
    return res;
  });
}

// src/modals/copy-verse-modal.ts
function setPreviewText(previewEl, userInput, pluginSettings, translationPath) {
  return __async(this, null, function* () {
    try {
      const res = yield getTextOfVerses(this.app, userInput, pluginSettings, translationPath, false);
      previewEl.setText(res);
    } catch (e) {
      previewEl.setText("");
      return;
    }
  });
}
var CopyVerseModal = class extends import_obsidian3.Modal {
  constructor(app, settings, onSubmit) {
    super(app);
    this.handleInput = () => __async(this, null, function* () {
      try {
        const res = yield getTextOfVerses(this.app, this.userInput, this.pluginSettings, this.translationPath);
        this.close();
        this.onSubmit(res);
      } catch (err) {
        return;
      }
    });
    this.onSubmit = onSubmit;
    this.pluginSettings = settings;
  }
  onOpen() {
    const { contentEl } = this;
    let previewEl;
    contentEl.createEl("h3", { text: "Copy verse by bible reference" });
    new import_obsidian3.Setting(contentEl).setName("Insert reference").addText((text) => text.onChange((value) => {
      this.userInput = value;
      setPreviewText(previewEl, this.userInput, this.pluginSettings, this.translationPath);
    }).inputEl.focus());
    if (this.pluginSettings.enableMultipleTranslations && this.pluginSettings.translationsPaths !== "") {
      const transationPicker = new import_obsidian3.Setting(contentEl).setName("Pick translation");
      let buttons = [];
      let buttonPathMap = new Map();
      this.pluginSettings.parsedTranslationPaths.forEach((path) => {
        transationPicker.addButton((btn) => {
          buttons.push(btn);
          buttonPathMap.set(btn, path);
          let splittedPath = path.split("/");
          btn.setButtonText(splittedPath[splittedPath.length - 2]);
        });
        buttons.forEach((btn) => {
          btn.onClick(() => {
            buttons.forEach((b) => b.removeCta());
            btn.setCta();
            this.translationPath = buttonPathMap.get(btn);
            setPreviewText(previewEl, this.userInput, this.pluginSettings, this.translationPath);
          });
        });
        buttons.first().setCta();
        this.translationPath = buttonPathMap.get(buttons.first());
      });
    }
    contentEl.createEl("label", { text: "Preview" });
    previewEl = contentEl.createEl("textarea", { cls: "copy-preview", attr: { readonly: true } });
    new import_obsidian3.Setting(contentEl).addButton((btn) => {
      btn.setButtonText("Link").setCta().onClick(this.handleInput);
    });
    contentEl.onkeydown = (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        this.handleInput();
      }
    };
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/modals/link-verse-modal.ts
var import_obsidian5 = __toModule(require("obsidian"));

// src/logic/link-command.ts
var import_obsidian4 = __toModule(require("obsidian"));
function createLinks(app, userInput, linkType, useNewLine, settings) {
  return __async(this, null, function* () {
    if (multipleChapters.test(userInput)) {
      return getLinksForChapters(app, userInput, linkType, useNewLine, settings);
    } else {
      return getLinksForVerses(app, userInput, linkType, useNewLine, settings);
    }
  });
}
function getLinksForVerses(app, userInput, linkType, useNewLine, settings) {
  return __async(this, null, function* () {
    let { bookAndChapter, beginVerse, endVerse } = parseUserVerseInput(userInput);
    bookAndChapter = capitalize(bookAndChapter);
    if (settings.verifyFilesWhenLinking) {
      const { fileName, tFile } = getFileByFilename(app, bookAndChapter);
      if (!tFile) {
        new import_obsidian4.Notice(`File "${fileName}" does not exist and verify files is set to true`);
        throw `File ${fileName} does not exist, verify files = true`;
      }
    }
    if (beginVerse > endVerse) {
      new import_obsidian4.Notice("Begin verse is bigger than end verse");
      throw "Begin verse is bigger than end verse";
    }
    let res = "";
    const beginning = linkType === LinkType.Embedded ? "!" : "";
    const ending = linkType === LinkType.Invisible ? "|" : "";
    for (let i = beginVerse; i <= endVerse; i++) {
      res += `${beginning}[[${bookAndChapter}${settings.linkSeparator}${settings.versePrefix}${i}${ending}]]`;
      if (useNewLine) {
        res += "\n";
      }
    }
    return res;
  });
}
function getLinksForChapters(app, userInput, linkType, useNewLine, settings) {
  return __async(this, null, function* () {
    const { book, firstChapter, lastChapter } = parseUserBookInput(userInput);
    if (firstChapter > lastChapter) {
      new import_obsidian4.Notice("Begin chapter is bigger than end chapter");
      throw "Begin chapter is bigger than end chapter";
    }
    let res = "";
    for (let i = firstChapter; i <= lastChapter; i++) {
      res += `[[${book} ${i}]]`;
      if (useNewLine) {
        res += "\n";
      }
    }
    return res;
  });
}

// src/modals/link-verse-modal.ts
var LinkType;
(function(LinkType2) {
  LinkType2["Basic"] = "Basic";
  LinkType2["Embedded"] = "Embedded";
  LinkType2["Invisible"] = "Invisible";
})(LinkType || (LinkType = {}));
var LinkVerseModal = class extends import_obsidian5.Modal {
  constructor(app, settings, onSubmit) {
    super(app);
    this.handleInput = () => __async(this, null, function* () {
      try {
        const res = yield createLinks(this.app, this.userInput, this.linkType, this.useNewLine, this.pluginSettings);
        this.close();
        this.onSubmit(res);
      } catch (err) {
        return;
      }
    });
    this.onSubmit = onSubmit;
    this.pluginSettings = settings;
    this.linkType = this.pluginSettings.linkTypePreset;
    this.useNewLine = this.pluginSettings.newLinePreset;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h3", { text: "Create Obsidian links from Bible reference" });
    new import_obsidian5.Setting(contentEl).setName("Insert reference").addText((text) => text.onChange((value) => {
      this.userInput = value;
    }).inputEl.focus());
    new import_obsidian5.Setting(contentEl).setName("Link type").addDropdown((dropdown) => {
      dropdown.addOption(LinkType.Basic, LinkType.Basic);
      dropdown.addOption(LinkType.Embedded, LinkType.Embedded);
      dropdown.addOption(LinkType.Invisible, LinkType.Invisible);
      dropdown.onChange((value) => this.linkType = value);
      dropdown.setValue(this.pluginSettings.linkTypePreset);
    });
    new import_obsidian5.Setting(contentEl).setName("Each link on new line?").addToggle((tgl) => {
      tgl.setValue(this.pluginSettings.newLinePreset);
      tgl.onChange((val) => this.useNewLine = val);
    });
    new import_obsidian5.Setting(contentEl).addButton((btn) => {
      btn.setButtonText("Link").setCta().onClick(this.handleInput);
    });
    contentEl.onkeydown = (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        this.handleInput();
      }
    };
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// src/settings.ts
var import_obsidian6 = __toModule(require("obsidian"));
var SettingsTab = class extends import_obsidian6.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Copy and Link Bible verses command" });
    containerEl.createEl("h4", { text: "Functional" });
    new import_obsidian6.Setting(containerEl).setName("Verse offset").setDesc('Change this if wrong verses are being linked, e.g. you want "Gen 1,1-3" but output is text from verses 2-4 \u2192 set this to -1').setClass("important-setting").addText((inputBox) => inputBox.setValue(this.plugin.settings.verseOffset.toString()).onChange((value) => __async(this, null, function* () {
      const number = Number.parseInt(value);
      if (value === "-")
        return;
      if (Number.isNaN(number)) {
        new import_obsidian6.Notice("Invalid input, please insert valid integer");
        inputBox.setValue("");
        return;
      }
      this.plugin.settings.verseOffset = number;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Verse heading level").setDesc('If set, only headings of specified level are considered verses (if first heading of this level is always a verse, also set "Verse offset" to -1)').addDropdown((dropdown) => {
      var _a, _b;
      dropdown.addOption("any", "any");
      dropdown.addOption("6", "######");
      dropdown.addOption("5", "#####");
      dropdown.addOption("4", "####");
      dropdown.addOption("3", "###");
      dropdown.addOption("2", "##");
      dropdown.addOption("1", "#");
      dropdown.setValue((_b = (_a = this.plugin.settings.verseHeadingLevel) == null ? void 0 : _a.toString()) != null ? _b : "any");
      dropdown.onChange((value) => __async(this, null, function* () {
        this.plugin.settings.verseHeadingLevel = value === "any" ? void 0 : Number(value);
        yield this.plugin.saveSettings();
      }));
    });
    containerEl.createEl("h4", { text: "Inserted prefixes/postfixes" });
    new import_obsidian6.Setting(containerEl).setName("Line prefix").setDesc("String inserted in front of every line, for example '>' for quote. Note: If you set 'Put each verse on a new line?' to true, the prefix will be inserted in front of every line.").setClass("important-setting").addText((inputBox) => inputBox.setPlaceholder("Insert prefix here").setValue(this.plugin.settings.prefix).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.prefix = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Link postfix").setDesc("String inserted after biblical link, you can use \\n to insert newline.").addText((inputBox) => inputBox.setPlaceholder("Insert postfix here").setValue(this.plugin.settings.postfix).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.postfix = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Each verse prefix").setDesc('String inserted in front of every copied verse. You can use "{n}" where you want number of given verse inserted, for example "**{n}** " will make each verse start with bold verse number. You can also use "{f}" to insert name of the corresponding file (for example to create obsidian links). Leave empty for no prefix.').addText((inputBox) => inputBox.setPlaceholder("Insert prefix here").setValue(this.plugin.settings.eachVersePrefix).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.eachVersePrefix = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Links" });
    new import_obsidian6.Setting(containerEl).setName("Link to last verse?").setDesc("Should last verse be linked in the visible link before text of verses?").addToggle((toggle) => toggle.setValue(this.plugin.settings.linkEndVerse).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.linkEndVerse = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Add invisible links?").setDesc("Invisible links are added to each verse used (so you can find the connections later), they are only visible in source mode.").addToggle((toggle) => toggle.setValue(this.plugin.settings.useInvisibleLinks).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.useInvisibleLinks = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Output format" });
    new import_obsidian6.Setting(containerEl).setName("Put each verse on a new line?").setDesc("Each verse is inserted on a new line (with Link prefix).").addToggle((toggle) => toggle.setValue(this.plugin.settings.newLines).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.newLines = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Insert space between verses?").setDesc("Should space be inserted between verses? (Only applied when Put each verse on a new line? is se to false. Useful for languages such as Chinese.)").setDisabled(!this.plugin.settings.newLines).addToggle((toggle) => toggle.setValue(this.plugin.settings.insertSpace).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.insertSpace = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Notation" });
    new import_obsidian6.Setting(containerEl).setName("One verse notation").setDesc('This is the symbol that will be used between chapter number and verse number when copying one verse. For example "." \u2192 Gen 1.1.').addText((inputBox) => inputBox.setPlaceholder("Insert notation symbol here").setValue(this.plugin.settings.oneVerseNotation).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.oneVerseNotation = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Multiple verses notation").setDesc('This is the symbol that will be used between chapter number and verse number when copying multiple verses. For example "," \u2192 Gen 1,1-3.').addText((inputBox) => inputBox.setPlaceholder("Insert notation symbol here").setValue(this.plugin.settings.multipleVersesNotation).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.multipleVersesNotation = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Multiple translations" });
    containerEl.createEl("p", {
      text: "As of right now this is an experimental feature. If you encounter any bugs or you can not figure things out create issue on the GitHub page of this plugin."
    });
    new import_obsidian6.Setting(containerEl).setName("Enable multiple translations").addToggle((toggle) => toggle.setValue(this.plugin.settings.enableMultipleTranslations).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.enableMultipleTranslations = value;
      yield this.plugin.saveSettings();
      this.display();
    })));
    if (this.plugin.settings.enableMultipleTranslations) {
      new import_obsidian6.Setting(containerEl).setName("Paths to translations with their names").setDesc('Input full paths to folders containing Bible translations, each trnaslation on separate line. An example of one entry: "Bible/NIV/". The plugin will search for corresponding Bible files using given paths as starting points. Make sure there are no duplicate files in given paths, otherwise it is hard to tell what the output will be. The first translation will be considered your main translation.').addTextArea((inputBox) => inputBox.setPlaceholder("Bible/NIV/\nBible/ESV/").setValue(this.plugin.settings.translationsPaths).onChange((value) => __async(this, null, function* () {
        const inputPaths = value.split(/\r?\n|\r/);
        const paths = [];
        inputPaths.forEach((path) => {
          if (path.at(-1) !== "/") {
            paths.push(path + "/");
          } else {
            paths.push(path);
          }
        });
        this.plugin.settings.translationsPaths = value;
        this.plugin.settings.parsedTranslationPaths = paths;
        yield this.plugin.saveSettings();
      })));
      new import_obsidian6.Setting(containerEl).setName("What to link").setDesc("Choose what translations should be linked when copying a verse.").addDropdown((dropdown) => {
        dropdown.addOption("all", "Link to all translations");
        dropdown.addOption("used", "Link only to used translation");
        dropdown.addOption("usedAndMain", "Link to used and main translation");
        dropdown.addOption("main", "Link only to main translation");
        dropdown.setValue(this.plugin.settings.translationLinkingType);
        dropdown.onChange((value) => __async(this, null, function* () {
          this.plugin.settings.translationLinkingType = value;
          yield this.plugin.saveSettings();
        }));
      });
    }
    containerEl.createEl("h2", { text: "Link Bible verses command" });
    containerEl.createEl("h4", { text: "File format" });
    new import_obsidian6.Setting(containerEl).setName("Link separator").setDesc("This is the separator that will be used when linking, e.g. if you enter '#' here, output will be [[Gen 1#1]]. If you are using headings to mark verses, use '#'. If you are using block references, use '^'.").setClass("important-setting").addText((inputBox) => inputBox.setPlaceholder("Insert separator here").setValue(this.plugin.settings.linkSeparator).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.linkSeparator = value;
      yield this.plugin.saveSettings();
    })));
    new import_obsidian6.Setting(containerEl).setName("Verse prefix").setDesc('Fill this if you are using verse prefixes in your bible files, e.g. you have "v1" in your file \u2192 set to "v".').setClass("important-setting").addText((inputBox) => inputBox.setPlaceholder("Insert prefix here").setValue(this.plugin.settings.versePrefix).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.versePrefix = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Defaults" });
    new import_obsidian6.Setting(containerEl).setName("Link type default value").setDesc("Value that will be selected by default in link modal.").addDropdown((dropdown) => {
      dropdown.addOption(LinkType.Basic, LinkType.Basic);
      dropdown.addOption(LinkType.Embedded, LinkType.Embedded);
      dropdown.addOption(LinkType.Invisible, LinkType.Invisible);
      dropdown.setValue(this.plugin.settings.linkTypePreset);
      dropdown.onChange((value) => __async(this, null, function* () {
        this.plugin.settings.linkTypePreset = value;
        yield this.plugin.saveSettings();
      }));
    });
    new import_obsidian6.Setting(containerEl).setName("Use new lines default value").setDesc("Value that will be selected by default in link modal.").addToggle((toggle) => toggle.setValue(this.plugin.settings.newLinePreset).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.newLinePreset = value;
      yield this.plugin.saveSettings();
    })));
    containerEl.createEl("h4", { text: "Misc" });
    new import_obsidian6.Setting(containerEl).setName("Verify files?").setDesc("Verify existence of files you are trying to link, so that you are not inserting wrong references by mistake.").addToggle((toggle) => toggle.setValue(this.plugin.settings.verifyFilesWhenLinking).onChange((value) => __async(this, null, function* () {
      this.plugin.settings.verifyFilesWhenLinking = value;
      yield this.plugin.saveSettings();
    })));
  }
};

// src/main.ts
var DEFAULT_SETTINGS = {
  verseOffset: 0,
  verseHeadingLevel: void 0,
  prefix: "",
  postfix: "",
  eachVersePrefix: "",
  linkEndVerse: false,
  useInvisibleLinks: true,
  newLines: false,
  insertSpace: true,
  oneVerseNotation: ".",
  multipleVersesNotation: ",",
  enableMultipleTranslations: false,
  translationsPaths: "",
  parsedTranslationPaths: [],
  translationLinkingType: "all",
  linkSeparator: "#",
  versePrefix: "",
  linkTypePreset: LinkType.Basic,
  newLinePreset: true,
  verifyFilesWhenLinking: false
};
var BibleLinkerPlugin = class extends import_obsidian7.Plugin {
  constructor() {
    super(...arguments);
    this.openCopyModal = () => {
      const view = this.app.workspace.getActiveViewOfType(import_obsidian7.MarkdownView);
      if (view) {
        new CopyVerseModal(this.app, this.settings, (str) => view.editor.replaceRange(str, view.editor.getCursor())).open();
      }
    };
    this.openObsidianLinkModal = () => {
      const view = this.app.workspace.getActiveViewOfType(import_obsidian7.MarkdownView);
      if (view) {
        new LinkVerseModal(this.app, this.settings, (str) => view.editor.replaceRange(str, view.editor.getCursor())).open();
      }
    };
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      this.addSettingTab(new SettingsTab(this.app, this));
      this.addCommand({
        id: "insert-bible-link",
        name: "Copy and Link Bible verses",
        editorCallback: this.openCopyModal
      });
      this.addCommand({
        id: "insert-bible-link-obsidian-link",
        name: "Link Bible verses",
        editorCallback: this.openObsidianLinkModal
      });
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL21vZGFscy9jb3B5LXZlcnNlLW1vZGFsLnRzIiwgInNyYy9sb2dpYy9jb3B5LWNvbW1hbmQudHMiLCAic3JjL3V0aWxzL3JlZ2V4ZXMudHMiLCAic3JjL2xvZ2ljL2NvbW1vbi50cyIsICJzcmMvbW9kYWxzL2xpbmstdmVyc2UtbW9kYWwudHMiLCAic3JjL2xvZ2ljL2xpbmstY29tbWFuZC50cyIsICJzcmMvc2V0dGluZ3MudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IE1hcmtkb3duVmlldywgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgQ29weVZlcnNlTW9kYWwgZnJvbSAnc3JjL21vZGFscy9jb3B5LXZlcnNlLW1vZGFsJztcclxuaW1wb3J0IExpbmtWZXJzZU1vZGFsLCB7IExpbmtUeXBlIH0gZnJvbSAnLi9tb2RhbHMvbGluay12ZXJzZS1tb2RhbCc7XHJcbmltcG9ydCB7IFNldHRpbmdzVGFiIH0gZnJvbSAnLi9zZXR0aW5ncyc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBsdWdpblNldHRpbmdzIHtcclxuICAgIC8vIENPUFlcclxuICAgIC8vIEZ1bmN0aW9uYWxcclxuICAgIHZlcnNlT2Zmc2V0OiBudW1iZXI7XHJcbiAgICB2ZXJzZUhlYWRpbmdMZXZlbD86IG51bWJlcjtcclxuXHJcbiAgICAvLyBJbnNlcnRlZCBwcmVmaXhlcy9wb3N0Zml4ZXNcclxuICAgIHByZWZpeDogc3RyaW5nO1xyXG4gICAgcG9zdGZpeDogc3RyaW5nO1xyXG4gICAgZWFjaFZlcnNlUHJlZml4OiBzdHJpbmc7XHJcblxyXG4gICAgLy8gTGlua3NcclxuICAgIGxpbmtFbmRWZXJzZTogYm9vbGVhbjtcclxuICAgIHVzZUludmlzaWJsZUxpbmtzOiBib29sZWFuO1xyXG5cclxuICAgIC8vIE91dHB1dCBmb3JtYXRcclxuICAgIG5ld0xpbmVzOiBib29sZWFuO1xyXG4gICAgaW5zZXJ0U3BhY2U6IGJvb2xlYW47XHJcblxyXG4gICAgLy8gTm90YXRpb25cclxuICAgIG9uZVZlcnNlTm90YXRpb246IHN0cmluZztcclxuICAgIG11bHRpcGxlVmVyc2VzTm90YXRpb246IHN0cmluZztcclxuXHJcbiAgICAvLyBNdWx0aXBsZSB0cmFuc2xhdGlvbnNcclxuICAgIGVuYWJsZU11bHRpcGxlVHJhbnNsYXRpb25zOiBib29sZWFuO1xyXG4gICAgdHJhbnNsYXRpb25zUGF0aHM6IHN0cmluZztcclxuICAgIHBhcnNlZFRyYW5zbGF0aW9uUGF0aHM6IHN0cmluZ1tdOyAvLyBjYWxsY3VsYXRlZCBmcm9tIHRyYW5zbGF0aW9ucyBwYXRocywgbm90IHNob3duIHRvIHRoZSB1c2VyXHJcbiAgICB0cmFuc2xhdGlvbkxpbmtpbmdUeXBlOiBzdHJpbmc7XHJcblxyXG4gICAgLy8gTElOS1xyXG4gICAgLy8gRmlsZSBmb3JtYXRcclxuICAgIGxpbmtTZXBhcmF0b3I6IHN0cmluZztcclxuICAgIHZlcnNlUHJlZml4OiBzdHJpbmc7XHJcblxyXG4gICAgLy8gRGVmYXVsdHNcclxuICAgIGxpbmtUeXBlUHJlc2V0OiBMaW5rVHlwZTtcclxuICAgIG5ld0xpbmVQcmVzZXQ6IGJvb2xlYW47XHJcblxyXG4gICAgLy8gTWlzY1xyXG4gICAgdmVyaWZ5RmlsZXNXaGVuTGlua2luZzogYm9vbGVhbjtcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogUGFydGlhbDxQbHVnaW5TZXR0aW5ncz4gPSB7XHJcbiAgICAvLyBDT1BZXHJcbiAgICAvLyBGdW5jdGlvbmFsXHJcbiAgICB2ZXJzZU9mZnNldDogMCxcclxuICAgIHZlcnNlSGVhZGluZ0xldmVsOiB1bmRlZmluZWQsXHJcblxyXG4gICAgLy8gSW5zZXJ0ZWQgcHJlZml4ZXMvcG9zdGZpeGVzXHJcbiAgICBwcmVmaXg6IFwiXCIsXHJcbiAgICBwb3N0Zml4OiBcIlwiLFxyXG4gICAgZWFjaFZlcnNlUHJlZml4OiBcIlwiLFxyXG5cclxuICAgIC8vIExpbmtzXHJcbiAgICBsaW5rRW5kVmVyc2U6IGZhbHNlLFxyXG4gICAgdXNlSW52aXNpYmxlTGlua3M6IHRydWUsXHJcblxyXG4gICAgLy8gT3V0cHV0IGZvcm1hdFxyXG4gICAgbmV3TGluZXM6IGZhbHNlLFxyXG4gICAgaW5zZXJ0U3BhY2U6IHRydWUsXHJcblxyXG4gICAgLy8gTm90YXRpb25cclxuICAgIG9uZVZlcnNlTm90YXRpb246IFwiLlwiLFxyXG4gICAgbXVsdGlwbGVWZXJzZXNOb3RhdGlvbjogXCIsXCIsXHJcblxyXG4gICAgLy8gTXVsdGlwbGUgdHJhbnNsYXRpb25zXHJcbiAgICBlbmFibGVNdWx0aXBsZVRyYW5zbGF0aW9uczogZmFsc2UsXHJcbiAgICB0cmFuc2xhdGlvbnNQYXRoczogXCJcIixcclxuICAgIHBhcnNlZFRyYW5zbGF0aW9uUGF0aHM6IFtdLFxyXG4gICAgdHJhbnNsYXRpb25MaW5raW5nVHlwZTogXCJhbGxcIixcclxuXHJcbiAgICAvLyBMSU5LXHJcbiAgICAvLyBGaWxlIGZvcm1hdFxyXG4gICAgbGlua1NlcGFyYXRvcjogXCIjXCIsXHJcbiAgICB2ZXJzZVByZWZpeDogXCJcIixcclxuXHJcbiAgICAvLyBEZWZhdWx0c1xyXG4gICAgbGlua1R5cGVQcmVzZXQ6IExpbmtUeXBlLkJhc2ljLFxyXG4gICAgbmV3TGluZVByZXNldDogdHJ1ZSxcclxuXHJcbiAgICAvLyBNaXNjXHJcbiAgICB2ZXJpZnlGaWxlc1doZW5MaW5raW5nOiBmYWxzZSxcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQmlibGVMaW5rZXJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gICAgc2V0dGluZ3M6IFBsdWdpblNldHRpbmdzO1xyXG5cclxuICAgIC8vIE9wZW5zIG1vZGFsIGZvciB0ZXh0IGNvcHlpbmdcclxuICAgIG9wZW5Db3B5TW9kYWwgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XHJcbiAgICAgICAgaWYgKHZpZXcpIHtcclxuICAgICAgICAgICAgbmV3IENvcHlWZXJzZU1vZGFsKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzLFxyXG4gICAgICAgICAgICAgICAgKHN0cikgPT4gdmlldy5lZGl0b3IucmVwbGFjZVJhbmdlKHN0ciwgdmlldy5lZGl0b3IuZ2V0Q3Vyc29yKCkpKS5vcGVuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE9wZW5zIG1vZGFsIGZvciBjcmVhdGluZyBvYnNpZGlhbiBsaW5rc1xyXG4gICAgb3Blbk9ic2lkaWFuTGlua01vZGFsID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xyXG4gICAgICAgIGlmICh2aWV3KSB7XHJcbiAgICAgICAgICAgIG5ldyBMaW5rVmVyc2VNb2RhbCh0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncyxcclxuICAgICAgICAgICAgICAgIChzdHIpID0+IHZpZXcuZWRpdG9yLnJlcGxhY2VSYW5nZShzdHIsIHZpZXcuZWRpdG9yLmdldEN1cnNvcigpKSkub3BlbigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncylcclxuICAgIH1cclxuXHJcbiAgICAvLyBSdW4gb25jZSB3aGVuIHBsdWdpbiBpcyBsb2FkZWRcclxuICAgIGFzeW5jIG9ubG9hZCgpIHtcclxuICAgICAgICAvLyBIYW5kbGUgc2V0dGluZ3NcclxuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgU2V0dGluZ3NUYWIodGhpcy5hcHAsIHRoaXMpKVxyXG5cclxuICAgICAgICAvLyBBZGQgaWNvbiB0byBpbnNlcnQgbGluayBcclxuICAgICAgICAvLyB0aGlzLmFkZFJpYmJvbkljb24oXCJsaW5rXCIsIFwiSW5zZXJ0IGJpYmxlIGxpbmtcIiwgKGV2dDogTW91c2VFdmVudCkgPT4gdGhpcy5vcGVuQ29weU1vZGFsKCkpO1xyXG5cclxuICAgICAgICAvLyBDb21tYW5kIHRvIGluc2VydCBsaW5rIChvbmx5IGF2YWlsYWJsZSBpbiBlZGl0b3IgbW9kZSlcclxuICAgICAgICB0aGlzLmFkZENvbW1hbmQoe1xyXG4gICAgICAgICAgICBpZDogJ2luc2VydC1iaWJsZS1saW5rJywgLy8gSUQgbGVmdCB0byBwcmVzZXJ2ZSB1c2VyJ3Mga2V5IG1hcHBpbmdzXHJcbiAgICAgICAgICAgIG5hbWU6IFwiQ29weSBhbmQgTGluayBCaWJsZSB2ZXJzZXNcIixcclxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IHRoaXMub3BlbkNvcHlNb2RhbFxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vIENvbW1hbmQgdG8gaW5zZXJ0IGxpbmsgKG9ubHkgYXZhaWxhYmxlIGluIGVkaXRvciBtb2RlKVxyXG4gICAgICAgIHRoaXMuYWRkQ29tbWFuZCh7XHJcbiAgICAgICAgICAgIGlkOiAnaW5zZXJ0LWJpYmxlLWxpbmstb2JzaWRpYW4tbGluaycsXHJcbiAgICAgICAgICAgIG5hbWU6IFwiTGluayBCaWJsZSB2ZXJzZXNcIixcclxuICAgICAgICAgICAgZWRpdG9yQ2FsbGJhY2s6IHRoaXMub3Blbk9ic2lkaWFuTGlua01vZGFsXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufVxyXG4iLCAiaW1wb3J0IHsgQXBwLCBCdXR0b25Db21wb25lbnQsIE1vZGFsLCBTZXR0aW5nIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCB7IFBsdWdpblNldHRpbmdzIH0gZnJvbSBcIi4uL21haW5cIjtcclxuaW1wb3J0IHsgZ2V0VGV4dE9mVmVyc2VzIH0gZnJvbSBcIi4uL2xvZ2ljL2NvcHktY29tbWFuZFwiO1xyXG5cclxuLyoqXHJcbiAqIEFzeW5jIGZ1bmN0aW9uIGZvciBmZXRjaGluZyBwcmV2aWV3IFxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gc2V0UHJldmlld1RleHQocHJldmlld0VsOiBIVE1MVGV4dEFyZWFFbGVtZW50LCB1c2VySW5wdXQ6IHN0cmluZywgcGx1Z2luU2V0dGluZ3M6IFBsdWdpblNldHRpbmdzLCB0cmFuc2xhdGlvblBhdGg6IHN0cmluZykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRUZXh0T2ZWZXJzZXModGhpcy5hcHAsIHVzZXJJbnB1dCwgcGx1Z2luU2V0dGluZ3MsIHRyYW5zbGF0aW9uUGF0aCwgZmFsc2UpO1xyXG4gICAgICAgIHByZXZpZXdFbC5zZXRUZXh0KHJlcyk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCB7XHJcbiAgICAgICAgcHJldmlld0VsLnNldFRleHQoXCJcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogTW9kYWwgdGhhdCBsZXRzIHlvdSBpbnNlcnQgYmlibGUgcmVmZXJlbmNlIGJ5IGNvcHlpbmcgdGV4dCBvZiBnaXZlbiB2ZXJzZXNcclxuICovXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvcHlWZXJzZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xyXG4gICAgdXNlcklucHV0OiBzdHJpbmdcclxuICAgIG9uU3VibWl0OiAocmVzdWx0OiBzdHJpbmcpID0+IHZvaWRcclxuICAgIHBsdWdpblNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncztcclxuICAgIHRyYW5zbGF0aW9uUGF0aDogc3RyaW5nO1xyXG5cclxuICAgIGhhbmRsZUlucHV0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldFRleHRPZlZlcnNlcyh0aGlzLmFwcCwgdGhpcy51c2VySW5wdXQsIHRoaXMucGx1Z2luU2V0dGluZ3MsIHRoaXMudHJhbnNsYXRpb25QYXRoKTtcclxuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICAgICAgICB0aGlzLm9uU3VibWl0KHJlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgc2V0dGluZ3M6IFBsdWdpblNldHRpbmdzLCBvblN1Ym1pdDogKHJlc3VsdDogc3RyaW5nKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgc3VwZXIoYXBwKTtcclxuICAgICAgICB0aGlzLm9uU3VibWl0ID0gb25TdWJtaXQ7XHJcbiAgICAgICAgdGhpcy5wbHVnaW5TZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBvbk9wZW4oKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgbGV0IHByZXZpZXdFbDogSFRNTFRleHRBcmVhRWxlbWVudDtcclxuXHJcbiAgICAgICAgLy8gQWRkIGhlYWRpbmcgXHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDNcIiwgeyB0ZXh0OiBcIkNvcHkgdmVyc2UgYnkgYmlibGUgcmVmZXJlbmNlXCIgfSk7XHJcblxyXG4gICAgICAgIC8vIEFkZCBUZXh0Ym94IGZvciByZWZlcmVuY2VcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiSW5zZXJ0IHJlZmVyZW5jZVwiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4gdGV4dC5vbkNoYW5nZSgodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXNlcklucHV0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICBzZXRQcmV2aWV3VGV4dChwcmV2aWV3RWwsIHRoaXMudXNlcklucHV0LCB0aGlzLnBsdWdpblNldHRpbmdzLCB0aGlzLnRyYW5zbGF0aW9uUGF0aCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuaW5wdXRFbC5mb2N1cygpKTsgLy8gU2V0cyBmb2N1cyB0byBpbnB1dCBmaWVsZFxyXG5cclxuICAgICAgICAvLyBBZGQgdHJhbnNsYXRpb24gcGlja2VyXHJcbiAgICAgICAgaWYgKHRoaXMucGx1Z2luU2V0dGluZ3MuZW5hYmxlTXVsdGlwbGVUcmFuc2xhdGlvbnMgJiYgdGhpcy5wbHVnaW5TZXR0aW5ncy50cmFuc2xhdGlvbnNQYXRocyAhPT0gXCJcIikge1xyXG4gICAgICAgICAgICBjb25zdCB0cmFuc2F0aW9uUGlja2VyID0gbmV3IFNldHRpbmcoY29udGVudEVsKVxyXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoXCJQaWNrIHRyYW5zbGF0aW9uXCIpXHJcblxyXG4gICAgICAgICAgICBsZXQgYnV0dG9uczogQnV0dG9uQ29tcG9uZW50W10gPSBbXTtcclxuICAgICAgICAgICAgbGV0IGJ1dHRvblBhdGhNYXAgPSBuZXcgTWFwPEJ1dHRvbkNvbXBvbmVudCwgc3RyaW5nPigpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHRoaXMucGx1Z2luU2V0dGluZ3MucGFyc2VkVHJhbnNsYXRpb25QYXRocy5mb3JFYWNoKChwYXRoKSA9PiB7IC8vIGRpc3BsYXkgdHJhbnNsYXRpb24gYnV0dG9uc1xyXG4gICAgICAgICAgICAgICAgdHJhbnNhdGlvblBpY2tlclxyXG4gICAgICAgICAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25zLnB1c2goYnRuKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uUGF0aE1hcC5zZXQoYnRuLCBwYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNwbGl0dGVkUGF0aCA9IHBhdGguc3BsaXQoXCIvXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidG4uc2V0QnV0dG9uVGV4dChzcGxpdHRlZFBhdGhbc3BsaXR0ZWRQYXRoLmxlbmd0aCAtIDJdKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaCgoYnRuKSA9PiB7IC8vIG1ha2Ugc3VyZSB0aGF0IG9ubHkgb25lIGlzIHNlbGVjdGVkIGF0IGEgdGltZVxyXG4gICAgICAgICAgICAgICAgICAgIGJ0bi5vbkNsaWNrKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9ucy5mb3JFYWNoKChiKSA9PiBiLnJlbW92ZUN0YSgpKTsgLy8gcmVtb3ZlIENUQSBmcm9tIGFsbCBidXR0b25zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ0bi5zZXRDdGEoKTsgLy8gc2V0IENUQSB0byB0aGlzIGJ1dHRvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zbGF0aW9uUGF0aCA9IGJ1dHRvblBhdGhNYXAuZ2V0KGJ0bik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFByZXZpZXdUZXh0KHByZXZpZXdFbCwgdGhpcy51c2VySW5wdXQsIHRoaXMucGx1Z2luU2V0dGluZ3MsIHRoaXMudHJhbnNsYXRpb25QYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBwcmVzZWxlY3QgdGhlIGZpcnN0IGJ1dHRvbi90cm5hc2xhdGlvblxyXG4gICAgICAgICAgICAgICAgYnV0dG9ucy5maXJzdCgpLnNldEN0YSgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc2xhdGlvblBhdGggPSBidXR0b25QYXRoTWFwLmdldChidXR0b25zLmZpcnN0KCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEFkZCBwcmV2aWV3XHJcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwibGFiZWxcIiwgeyB0ZXh0OiBcIlByZXZpZXdcIiB9KTtcclxuICAgICAgICBwcmV2aWV3RWwgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJ0ZXh0YXJlYVwiLCB7IGNsczogJ2NvcHktcHJldmlldycsIGF0dHI6IHsgcmVhZG9ubHk6IHRydWUgfSB9KTtcclxuXHJcblxyXG4gICAgICAgIC8vIEFkZCBidXR0b24gZm9yIHN1Ym1pdC9leGl0XHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxyXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcclxuICAgICAgICAgICAgICAgIGJ0blxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiTGlua1wiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRDdGEoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKHRoaXMuaGFuZGxlSW5wdXQpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBBbGxvdyB1c2VyIHRvIGV4aXQgdXNpbmcgRW50ZXIga2V5XHJcbiAgICAgICAgY29udGVudEVsLm9ua2V5ZG93biA9IChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSBcIkVudGVyXCIpIHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUlucHV0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25DbG9zZSgpIHtcclxuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcclxuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcclxuICAgIH1cclxufVxyXG5cclxuIiwgImltcG9ydCB7IEFwcCwgSGVhZGluZ0NhY2hlLCBOb3RpY2UsIFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcbmltcG9ydCB7IFBsdWdpblNldHRpbmdzIH0gZnJvbSBcIi4uL21haW5cIjtcclxuaW1wb3J0IHsgaXNPQlNLRmlsZSB9IGZyb20gXCIuLi91dGlscy9yZWdleGVzXCI7XHJcbmltcG9ydCB7IGNhcGl0YWxpemUsIGdldEZpbGVCeUZpbGVuYW1lIGFzIGdldFRGaWxlQnlGaWxlbmFtZSwgcGFyc2VVc2VyVmVyc2VJbnB1dCB9IGZyb20gXCIuL2NvbW1vblwiO1xyXG5cclxuLyoqXHJcbiAqIENvbnZlcnRzIGJpYmxpY2FsIHJlZmVyZW5jZSB0byB0ZXh0IG9mIGdpdmVuIHZlcnNlc1xyXG4gKiBAcGFyYW0gYXBwIEFwcCBpbnN0YW5jZVxyXG4gKiBAcGFyYW0gdXNlcklucHV0IFVzZXIgSW5wdXQgKGxpbmsgdG8gdmVyc2UpXHJcbiAqIEByZXR1cm5zIFN0cmluZyB3aXRoIHF1b3RlIG9mIGxpbmtlZCB2ZXJzZXMuIElmIGNvbnZlcnRpbmcgd2FzIG5vdCBzdWNjZXNzZnVsLCByZXR1cm5zIGVtcHR5IHN0cmluZy5cclxuICogQHZlcmJvc2UgRGV0ZXJtaW5lcyBpZiBOb3RpY2VzIHdpbGwgYmUgc2hvd24gb3Igbm90XHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VGV4dE9mVmVyc2VzKGFwcDogQXBwLCB1c2VySW5wdXQ6IHN0cmluZywgc2V0dGluZ3M6IFBsdWdpblNldHRpbmdzLCB0cmFuc2xhdGlvblBhdGg6IHN0cmluZywgdmVyYm9zZSA9IHRydWUsKTogUHJvbWlzZTxzdHJpbmc+IHtcclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XHJcbiAgICBsZXQgeyBib29rQW5kQ2hhcHRlciwgYmVnaW5WZXJzZSwgZW5kVmVyc2UgfSA9IHBhcnNlVXNlclZlcnNlSW5wdXQodXNlcklucHV0LCB2ZXJib3NlKTtcclxuICAgIGJvb2tBbmRDaGFwdGVyID0gY2FwaXRhbGl6ZShib29rQW5kQ2hhcHRlcikgLy8gRm9yIG91dHB1dCBjb25zaXN0ZW5jeVxyXG4gICAgY29uc3QgeyBmaWxlTmFtZSwgdEZpbGUgfSA9IGdldFRGaWxlQnlGaWxlbmFtZShhcHAsIGJvb2tBbmRDaGFwdGVyLCB0cmFuc2xhdGlvblBhdGgpO1xyXG4gICAgaWYgKHRGaWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZUNvcHlPdXRwdXQoYXBwLCB0RmlsZSwgZmlsZU5hbWUsIGJlZ2luVmVyc2UsIGVuZFZlcnNlLCBzZXR0aW5ncywgdHJhbnNsYXRpb25QYXRoLCB2ZXJib3NlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHZlcmJvc2UpIHtcclxuICAgICAgICAgICAgbmV3IE5vdGljZShgRmlsZSAke2Jvb2tBbmRDaGFwdGVyfSBub3QgZm91bmRgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgXCJGaWxlIG5vdCBmb3VuZFwiXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHRleHQgb2YgZ2l2ZW4gdmVyc2UgdXNpbmcgZ2l2ZW4gaGVhZGluZ3MgYW5kIGxpbmVzLlxyXG4gKiBAcGFyYW0gdmVyc2VOdW1iZXIgTnVtYmVyIG9mIGRlc2lyZWQgdmVyc2UuXHJcbiAqIEBwYXJhbSBoZWFkaW5ncyBMaXN0IG9mIGhlYWRpbmdzIHRoYXQgc2hvdWxkIGJlIHNlYXJjaGVkLiBTZWNvbmQgaGVhZGluZyBtdXN0IGNvcnJlc3BvbmQgdG8gZmlyc3QgdmVyc2UsIHRoaXJkIGhlYWRpbmcgdG8gc2Vjb25kIHZlcnNlIGFuZCBzbyBvbi5cclxuICogQHBhcmFtIGxpbmVzIExpbmVzIG9mIGZpbGUgZnJvbSB3aGljaCB2ZXJzZSB0ZXh0IHNob3VsZCBiZSB0YWtlbi5cclxuICogQHBhcmFtIGtlZXBOZXdsaW5lcyBJZiBzZXQgdG8gdHJ1ZSwgdGV4dCB3aWxsIGNvbnRhaW4gbmV3bGluZXMgaWYgcHJlc2VudCBpbiBzb3VyY2UsIGlmIHNldCB0byBmYWxzZSwgbmV3bGluZXMgd2lsbCBiZSBjaGFuZ2VkIHRvIHNwYWNlc1xyXG4gKiBAcGFyYW0gbmV3TGluZVByZWZpeCBQcmVmaXggZm9yIGVhY2ggbGluZSBvZiB2ZXJzZSwgaWYgdmVyc2UgaXMgbXVsdGlsaW5lIGFuZCBrZWVwTmV3TGluZXMgPSB0cnVlXHJcbiAqIEByZXR1cm5zIFRleHQgb2YgZ2l2ZW4gdmVyc2UuXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRWZXJzZVRleHQodmVyc2VOdW1iZXI6IG51bWJlciwgaGVhZGluZ3M6IEhlYWRpbmdDYWNoZVtdLCBsaW5lczogc3RyaW5nW10sIGtlZXBOZXdsaW5lczogYm9vbGVhbiwgbmV3TGluZVByZWZpeDogc3RyaW5nKSB7XHJcbiAgICBpZiAodmVyc2VOdW1iZXIgPj0gaGVhZGluZ3MubGVuZ3RoKSB7IC8vIG91dCBvZiByYW5nZVxyXG4gICAgICAgIG5ldyBOb3RpY2UoXCJWZXJzZSBvdXQgb2YgcmFuZ2UgZm9yIGdpdmVuIGZpbGVcIilcclxuICAgICAgICB0aHJvdyBgVmVyc2VOdW1iZXIgJHt2ZXJzZU51bWJlcn0gaXMgb3V0IG9mIHJhbmdlIG9mIGhlYWRpbmdzIHdpdGggbGVuZ3RoICR7aGVhZGluZ3MubGVuZ3RofWBcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBoZWFkaW5nTGluZSA9IGhlYWRpbmdzW3ZlcnNlTnVtYmVyXS5wb3NpdGlvbi5zdGFydC5saW5lO1xyXG4gICAgaWYgKGhlYWRpbmdMaW5lICsgMSA+PSBsaW5lcy5sZW5ndGgpIHsgLy8gb3V0IG9mIHJhbmdlXHJcbiAgICAgICAgbmV3IE5vdGljZShcIkxvZ2ljYWwgZXJyb3IgLSBwbGVhc2UgY3JlYXRlIGlzc3VlIG9uIHBsdWdpbidzIEdpdEh1YiB3aXRoIHlvdXIgaW5wdXQgYW5kIHRoZSBmaWxlIHlvdSB3ZXJlIHJlZmVyZW5jaW5nLiBUaGFuayB5b3UhXCIpXHJcbiAgICAgICAgdGhyb3cgYEhlYWRpbmdMaW5lICR7aGVhZGluZ0xpbmUgKyAxfSBpcyBvdXQgb2YgcmFuZ2Ugb2YgbGluZXMgd2l0aCBsZW5ndGggJHtsaW5lc31gXHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGhpcyBwYXJ0IGlzIG5lY2Vzc2FyeSBmb3IgdmVyc2VzIHRoYXQgc3BhbiBvdmVyIG11bHRpcGxlIGxpbmVzXHJcbiAgICBsZXQgb3V0cHV0ID0gXCJcIjtcclxuICAgIGxldCBsaW5lID0gXCJcIjtcclxuICAgIGxldCBpID0gMTtcclxuICAgIGxldCBpc0ZpcnN0ID0gdHJ1ZTtcclxuXHJcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc3RhbnQtY29uZGl0aW9uXHJcbiAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgIGxpbmUgPSBsaW5lc1toZWFkaW5nTGluZSArIGldOyAvLyBnZXQgbmV4dCBsaW5lXHJcbiAgICAgICAgaWYgKC9eIy8udGVzdChsaW5lKSB8fCAoIWxpbmUgJiYgIWlzRmlyc3QpKSB7XHJcbiAgICAgICAgICAgIGJyZWFrOyAvLyBoZWFkaW5nIGxpbmUgKG5leHQgdmVyc2UpIG9yIGVtcHR5IGxpbmUgYWZ0ZXIgdmVyc2UgPT4gZG8gbm90IGNvbnRpbnVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkrKztcclxuICAgICAgICBpZiAobGluZSkgeyAvLyBpZiBsaW5lIGhhcyBjb250ZW50IChpcyBub3QgZW1wdHkgc3RyaW5nKVxyXG4gICAgICAgICAgICBpZiAoIWlzRmlyc3QpIHsgLy8gSWYgaXQgaXMgbm90IGZpcnN0IGxpbmUgb2YgdGhlIHZlcnNlLCBhZGQgZGl2aWRlclxyXG4gICAgICAgICAgICAgICAgb3V0cHV0ICs9IGtlZXBOZXdsaW5lcyA/IGBcXG4ke25ld0xpbmVQcmVmaXh9YCA6IFwiIFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlzRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgb3V0cHV0ICs9IGxpbmU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dHB1dDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFJlcGxhY2VzIFwiXFxuXCIgd2l0aCBuZXdsaW5lIGNoYXJhY3RlciBpbiBnaXZlbiBzdHJpbmcgKHdoZW4gdXNlciBpbnB1dHMgXCJcXG5cIiBpbiB0aGUgc2V0dGluZ3MgaXQgaXMgYXV0b21hdGljYWxseSBjb252ZXJ0ZWQgdG8gXCJcXFxcblwiIGFuZCBkb2VzIG5vdCB3b3JrIGFzIG5ld2xpbmUpXHJcbiAqL1xyXG5mdW5jdGlvbiByZXBsYWNlTmV3bGluZShpbnB1dDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gaW5wdXQucmVwbGFjZSgvXFxcXG4vZywgXCJcXG5cIiwpO1xyXG59XHJcblxyXG4vKipcclxuICogVGFrZXMgb3JnaW5hbCBmaWxlbmFtZSBhbmQgY29udmVydHMgaXQgdG8gaHVtYW4tcmVhZGFibGUgdmVyc2lvbiBpZiBCaWJsZSBzdHVkeSBraXQgaXMgdXNlZCAocmVtb3ZlcyBcIi1cIiBhbmQgbGVhZGluZyB6ZXJvcylcclxuICovXHJcbmZ1bmN0aW9uIGNyZWF0ZUJvb2tBbmRDaGFwdGVyT3V0cHV0KGZpbGVCYXNlbmFtZTogc3RyaW5nKSB7XHJcbiAgICBpZiAoaXNPQlNLRmlsZS50ZXN0KGZpbGVCYXNlbmFtZSkpIHtcclxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWNvbnN0XHJcbiAgICAgICAgbGV0IFssIGZpbGVuYW1lLCBjaGFwdGVyXSA9IGZpbGVCYXNlbmFtZS5tYXRjaChpc09CU0tGaWxlKTtcclxuICAgICAgICBpZiAoY2hhcHRlci50b1N0cmluZygpWzBdID09PSBcIjBcIikge1xyXG4gICAgICAgICAgICBjaGFwdGVyID0gY2hhcHRlci5zdWJzdHJpbmcoMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmaWxlbmFtZSArIFwiIFwiICsgY2hhcHRlcjtcclxuICAgIH1cclxuICAgIHJldHVybiBmaWxlQmFzZW5hbWU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm5zIHBhdGggdG8gZm9sZGVyIGluIHdoaWNoIGdpdmVuIGZpbGUgaXMgbG9jYXRlZCBmb3IgbWFpbiB0cmFuc2xhdGlvblxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RmlsZUZvbGRlckluVHJhbnNsYXRpb24oYXBwOiBBcHAsIGZpbGVuYW1lOiBzdHJpbmcsIHRyYW5zbGF0aW9uOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHRGaWxlSW5mbyA9IGdldFRGaWxlQnlGaWxlbmFtZShhcHAsIGZpbGVuYW1lLCB0cmFuc2xhdGlvbik7XHJcbiAgICByZXR1cm4gdEZpbGVJbmZvLnRGaWxlLnBhcmVudC5wYXRoO1xyXG59XHJcblxyXG5cclxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ29weU91dHB1dChhcHA6IEFwcCwgdEZpbGU6IFRGaWxlLCBmaWxlTmFtZTogc3RyaW5nLCBiZWdpblZlcnNlOiBudW1iZXIsIGVuZFZlcnNlOiBudW1iZXIsIHNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncywgdHJhbnNsYXRpb25QYXRoOiBzdHJpbmcsIHZlcmJvc2U6IGJvb2xlYW4pIHtcclxuICAgIGNvbnN0IGJvb2tBbmRDaGFwdGVyT3V0cHV0ID0gY3JlYXRlQm9va0FuZENoYXB0ZXJPdXRwdXQodEZpbGUuYmFzZW5hbWUpO1xyXG4gICAgY29uc3QgZmlsZSA9IGFwcC52YXVsdC5yZWFkKHRGaWxlKVxyXG4gICAgY29uc3QgbGluZXMgPSAoYXdhaXQgZmlsZSkuc3BsaXQoL1xccj9cXG4vKVxyXG4gICAgY29uc3QgdmVyc2VIZWFkaW5nTGV2ZWwgPSBzZXR0aW5ncy52ZXJzZUhlYWRpbmdMZXZlbFxyXG4gICAgY29uc3QgaGVhZGluZ3MgPSBhcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUodEZpbGUpLmhlYWRpbmdzLmZpbHRlcihoZWFkaW5nID0+ICF2ZXJzZUhlYWRpbmdMZXZlbCB8fCBoZWFkaW5nLmxldmVsID09PSB2ZXJzZUhlYWRpbmdMZXZlbClcclxuICAgIGNvbnN0IGJlZ2luVmVyc2VOb09mZnNldCA9IGJlZ2luVmVyc2VcclxuICAgIGNvbnN0IGVuZFZlcnNlTm9PZmZzZXQgPSBlbmRWZXJzZVxyXG4gICAgYmVnaW5WZXJzZSArPSBzZXR0aW5ncy52ZXJzZU9mZnNldFxyXG4gICAgZW5kVmVyc2UgKz0gc2V0dGluZ3MudmVyc2VPZmZzZXRcclxuXHJcblxyXG4gICAgaWYgKGJlZ2luVmVyc2UgPiBlbmRWZXJzZSkge1xyXG4gICAgICAgIGlmICh2ZXJib3NlKSB7XHJcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJCZWdpbiB2ZXJzZSBpcyBiaWdnZXIgdGhhbiBlbmQgdmVyc2VcIilcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgXCJCZWdpbiB2ZXJzZSBpcyBiaWdnZXIgdGhhbiBlbmQgdmVyc2VcIlxyXG4gICAgfVxyXG4gICAgaWYgKGhlYWRpbmdzLmxlbmd0aCA8PSBiZWdpblZlcnNlKSB7XHJcbiAgICAgICAgaWYgKHZlcmJvc2UpIHtcclxuICAgICAgICAgICAgbmV3IE5vdGljZShcIkJlZ2luIHZlcnNlIG91dCBvZiByYW5nZSBvZiBjaGFwdGVyXCIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IFwiQmVnaW4gdmVyc2Ugb3V0IG9mIHJhbmdlIG9mIGNoYXB0ZXJcIlxyXG4gICAgfVxyXG5cclxuICAgIC8vIDEgLSBMaW5rIHRvIHZlcnNlc1xyXG4gICAgbGV0IHJlcyA9IHNldHRpbmdzLnByZWZpeDtcclxuICAgIGNvbnN0IHBvc3RmaXggPSBzZXR0aW5ncy5wb3N0Zml4ID8gcmVwbGFjZU5ld2xpbmUoc2V0dGluZ3MucG9zdGZpeCkgOiBcIiBcIjtcclxuICAgIGxldCBwYXRoVG9Vc2UgPSBcIlwiO1xyXG4gICAgaWYgKHNldHRpbmdzLmVuYWJsZU11bHRpcGxlVHJhbnNsYXRpb25zKSB7XHJcbiAgICAgICAgaWYgKHNldHRpbmdzLnRyYW5zbGF0aW9uTGlua2luZ1R5cGUgIT09IFwibWFpblwiKSAvLyBsaW5rIHRoZSB0cmFuc2xhdGlvbiB0aGF0IGlzIGN1cnJlbnRseSBiZWluZyB1c2VkXHJcbiAgICAgICAgICAgIHBhdGhUb1VzZSA9IGdldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHRyYW5zbGF0aW9uUGF0aCk7XHJcbiAgICAgICAgZWxzZSB7IC8vIGxpbmsgbWFpbiB0cmFuc2xhdGlvblxyXG4gICAgICAgICAgICBwYXRoVG9Vc2UgPSBnZXRGaWxlRm9sZGVySW5UcmFuc2xhdGlvbihhcHAsIGZpbGVOYW1lLCBzZXR0aW5ncy5wYXJzZWRUcmFuc2xhdGlvblBhdGhzLmZpcnN0KCkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoYmVnaW5WZXJzZSA9PT0gZW5kVmVyc2UpIHtcclxuICAgICAgICByZXMgKz0gYFtbJHtwYXRoVG9Vc2UgPyBwYXRoVG9Vc2UgKyBcIi9cIiA6IFwiXCJ9JHtmaWxlTmFtZX0jJHtoZWFkaW5nc1tiZWdpblZlcnNlXS5oZWFkaW5nfXwke2Jvb2tBbmRDaGFwdGVyT3V0cHV0fSR7c2V0dGluZ3Mub25lVmVyc2VOb3RhdGlvbn0ke2JlZ2luVmVyc2VOb09mZnNldH1dXSR7cG9zdGZpeH1gIC8vIFtbR2VuIDEjMXxHZW4gMSwxLjFdXVxyXG4gICAgfSBlbHNlIGlmIChzZXR0aW5ncy5saW5rRW5kVmVyc2UpIHtcclxuICAgICAgICByZXMgKz0gYFtbJHtwYXRoVG9Vc2UgPyBwYXRoVG9Vc2UgKyBcIi9cIiA6IFwiXCJ9JHtmaWxlTmFtZX0jJHtoZWFkaW5nc1tiZWdpblZlcnNlXS5oZWFkaW5nfXwke2Jvb2tBbmRDaGFwdGVyT3V0cHV0fSR7c2V0dGluZ3MubXVsdGlwbGVWZXJzZXNOb3RhdGlvbn0ke2JlZ2luVmVyc2VOb09mZnNldH0tXV1gIC8vIFtbR2VuIDEjMXxHZW4gMSwxLV1dXHJcbiAgICAgICAgcmVzICs9IGBbWyR7cGF0aFRvVXNlID8gcGF0aFRvVXNlICsgXCIvXCIgOiBcIlwifSR7ZmlsZU5hbWV9IyR7aGVhZGluZ3NbZW5kVmVyc2VdLmhlYWRpbmd9fCR7ZW5kVmVyc2VOb09mZnNldH1dXSR7cG9zdGZpeH1gOyAvLyBbW0dlbiAxIzN8M11dXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcyArPSBgW1ske3BhdGhUb1VzZSA/IHBhdGhUb1VzZSArIFwiL1wiIDogXCJcIn0ke2ZpbGVOYW1lfSMke2hlYWRpbmdzW2JlZ2luVmVyc2VdLmhlYWRpbmd9fCR7Ym9va0FuZENoYXB0ZXJPdXRwdXR9JHtzZXR0aW5ncy5tdWx0aXBsZVZlcnNlc05vdGF0aW9ufSR7YmVnaW5WZXJzZU5vT2Zmc2V0fS0ke2VuZFZlcnNlTm9PZmZzZXR9XV0ke3Bvc3RmaXh9YCAvLyBbW0dlbiAxIzF8R2VuIDEsMS0zXV1cclxuICAgIH1cclxuXHJcbiAgICAvLyAyIC0gVGV4dCBvZiB2ZXJzZXNcclxuICAgIGZvciAobGV0IGkgPSBiZWdpblZlcnNlOyBpIDw9IGVuZFZlcnNlOyBpKyspIHtcclxuICAgICAgICBsZXQgdmVyc2VQcmVmaXggPSBcIlwiO1xyXG4gICAgICAgIGNvbnN0IHZlcnNlUG9zdGZpeCA9IHNldHRpbmdzLmluc2VydFNwYWNlID8gXCIgXCIgOiBcIlwiO1xyXG4gICAgICAgIGlmIChzZXR0aW5ncy5lYWNoVmVyc2VQcmVmaXgpIHtcclxuICAgICAgICAgICAgdmVyc2VQcmVmaXggKz0gc2V0dGluZ3MuZWFjaFZlcnNlUHJlZml4LnJlcGxhY2UoL3tufS9nLCAoaSAtIHNldHRpbmdzLnZlcnNlT2Zmc2V0KS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgdmVyc2VQcmVmaXggPSB2ZXJzZVByZWZpeC5yZXBsYWNlKC97Zn0vZywgYCR7ZmlsZU5hbWV9YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHZlcnNlVGV4dCA9IGdldFZlcnNlVGV4dChpLCBoZWFkaW5ncywgbGluZXMsIHNldHRpbmdzLm5ld0xpbmVzLCBzZXR0aW5ncy5wcmVmaXgpO1xyXG4gICAgICAgIGlmIChzZXR0aW5ncy5uZXdMaW5lcykge1xyXG4gICAgICAgICAgICByZXMgKz0gXCJcXG5cIiArIHNldHRpbmdzLnByZWZpeCArIHZlcnNlUHJlZml4ICsgdmVyc2VUZXh0O1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJlcyArPSB2ZXJzZVByZWZpeCArIHZlcnNlVGV4dCArIHZlcnNlUG9zdGZpeDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMyAtIEludmlzaWJsZSBsaW5rc1xyXG5cclxuICAgIGlmICghc2V0dGluZ3MudXNlSW52aXNpYmxlTGlua3MpIHJldHVybiByZXM7XHJcbiAgICBpZiAoYmVnaW5WZXJzZSA9PSBlbmRWZXJzZSAvLyBObyBuZWVkIHRvIGFkZCBhbm90aGVyIGxpbmssIHdoZW4gb25seSBvbmUgdmVyc2UgaXMgYmVpbmcgbGlua2VkXHJcbiAgICAgICAgJiYgKCFzZXR0aW5ncy5lbmFibGVNdWx0aXBsZVRyYW5zbGF0aW9uc1xyXG4gICAgICAgICAgICB8fCBzZXR0aW5ncy50cmFuc2xhdGlvbkxpbmtpbmdUeXBlID09PSBcIm1haW5cIlxyXG4gICAgICAgICAgICB8fCBzZXR0aW5ncy50cmFuc2xhdGlvbkxpbmtpbmdUeXBlID09PSBcInVzZWRcIikpIC8vIE9ubHkgbGlua2luZyBvbmUgdHJhbnNsYXRpb24gLSBhbHJlYWR5IGxpbmtlZCBcclxuICAgICAgICByZXR1cm4gcmVzO1xyXG5cclxuICAgIGlmIChzZXR0aW5ncy5uZXdMaW5lcykge1xyXG4gICAgICAgIHJlcyArPSBgXFxuJHtzZXR0aW5ncy5wcmVmaXh9YDtcclxuICAgIH1cclxuICAgIGZvciAobGV0IGkgPSBiZWdpblZlcnNlOyBpIDw9IGVuZFZlcnNlOyBpKyspIHtcclxuICAgICAgICBpZiAoIXNldHRpbmdzLmVuYWJsZU11bHRpcGxlVHJhbnNsYXRpb25zKSB7XHJcbiAgICAgICAgICAgIHJlcyArPSBgW1ske2ZpbGVOYW1lfSMke2hlYWRpbmdzW2ldLmhlYWRpbmd9fF1dYFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHsgLy8gbXVsdGlwbGUgdHJhbnNsYXRpb25zIFxyXG4gICAgICAgICAgICBsZXQgdHJhbnNsYXRpb25QYXRoc1RvVXNlOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHNldHRpbmdzLnRyYW5zbGF0aW9uTGlua2luZ1R5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJhbGxcIjpcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvblBhdGhzVG9Vc2UgPSBzZXR0aW5ncy5wYXJzZWRUcmFuc2xhdGlvblBhdGhzLm1hcCgodHIpID0+IGdldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHRyKSlcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJ1c2VkXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb25QYXRoc1RvVXNlID0gW2dldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHRyYW5zbGF0aW9uUGF0aCldXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwidXNlZEFuZE1haW5cIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHJhbnNsYXRpb25QYXRoICE9PSBzZXR0aW5ncy5wYXJzZWRUcmFuc2xhdGlvblBhdGhzLmZpcnN0KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb25QYXRoc1RvVXNlID0gW2dldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHRyYW5zbGF0aW9uUGF0aCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHNldHRpbmdzLnBhcnNlZFRyYW5zbGF0aW9uUGF0aHMuZmlyc3QoKSldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb25QYXRoc1RvVXNlID0gW2dldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHRyYW5zbGF0aW9uUGF0aCldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJtYWluXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNsYXRpb25QYXRoc1RvVXNlID0gW2dldEZpbGVGb2xkZXJJblRyYW5zbGF0aW9uKGFwcCwgZmlsZU5hbWUsIHNldHRpbmdzLnBhcnNlZFRyYW5zbGF0aW9uUGF0aHMuZmlyc3QoKSldO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0cmFuc2xhdGlvblBhdGhzVG9Vc2UuZm9yRWFjaCgodHJhbnNsYXRpb25QYXRoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXMgKz0gYFtbJHt0cmFuc2xhdGlvblBhdGh9LyR7ZmlsZU5hbWV9IyR7aGVhZGluZ3NbaV0uaGVhZGluZ318XV1gXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuIiwgIi8qXHJcbiogUmVnZXhlcyBmb3IgdmVyc2UgcGFyc2luZ1xyXG4qL1xyXG5cclxuLy8gTGluayB0byBvbmUgdmVyc2UsIGZvciBleGFtcGxlIFwiR2VuIDEuMVwiIG9yIFwiR2VuIDE6MVwiXHJcbmV4cG9ydCBjb25zdCBvbmVWZXJzZVJlZ0V4ID0gbmV3IFJlZ0V4cCgvKFteLDojXSspWywjLjo7XVxccyooXFxkKylcXHMqJC8pO1xyXG5cclxuLy8gTGluayB0byBtdWx0aXBsZSB2ZXJzZXMsIGZvciBleGFtcGxlIFwiR2VuIDEsMS01XCJcclxuZXhwb3J0IGNvbnN0IG11bHRpcGxlVmVyc2VzUmVnRXggPSBuZXcgUmVnRXhwKC8oW14sOiNdKylbLCMuOjtdXFxzKihcXGQrKVxccypbLS49XVxccyooXFxkKylcXHMqJC8pO1xyXG5cclxuLy8gQm9vayBhbmQgY2hhcHRlciBzdHJpbmcgKHVzZWQgZm9yIGNvbnZlcnRpbmcgdG8gYmlibGUgc3R1ZHkga2l0IGZpbGUgbmFtZXMpXHJcbmV4cG9ydCBjb25zdCBib29rQW5kQ2hhcHRlclJlZ2V4Rm9yT0JTSyA9IC8oW14sOiNdKylcXHMoXFxkKykvXHJcblxyXG4vLyBNdWx0aXBsZSBjaGFwdGVycywgZm9yIGV4YW1wbGUgXCJHZW4gMS0zXCJcclxuZXhwb3J0IGNvbnN0IG11bHRpcGxlQ2hhcHRlcnMgPSAvKFxcZCpbXlxcZCw6I10rKVxccyooXFxkKylcXHMqLVxccyooXFxkKylcXHMqJC9cclxuXHJcbi8vIENhbiBiZSB1c2VkIHRvIGRldGVybWluZSB3aGV0aGVyIGdpdmVuIG5hbWUgb2YgZmlsZSBpcyBmcm9tIE9CU0sgKGZvciBleGFtcGxlIEdlbi0wMSlcclxuZXhwb3J0IGNvbnN0IGlzT0JTS0ZpbGUgPSAvKFthLXpBLVowLTkgXSspLShcXGR7MiwzfSkvXHJcbiIsICIvKlxyXG4gKiBDYXBpdGFsaXplcyBnaXZlbiBzdHJpbmcgKHNraXBzIGxlYWRpbmcgd2hpdGVzcGFjZXMgYW5kIG51bWJlcnMpXHJcbiAqL1xyXG5pbXBvcnQgeyBib29rQW5kQ2hhcHRlclJlZ2V4Rm9yT0JTSywgbXVsdGlwbGVDaGFwdGVycywgbXVsdGlwbGVWZXJzZXNSZWdFeCwgb25lVmVyc2VSZWdFeCB9IGZyb20gXCIuLi91dGlscy9yZWdleGVzXCI7XHJcbmltcG9ydCB7IEFwcCwgTm90aWNlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XHJcblxyXG4vKipcclxuICogQ2FwaXRhbGl6ZXMgZ2l2ZW4gc3RyaW5nLCB0YWtpbmcgbGVhZGluZyBudW1iZXJzIGludG8gYWNjb3VudFxyXG4gKiBAcGFyYW0gc3RyIFN0cmluZyB0aGF0IHNob3VsZCBiZSBjYXBpdGFsaXplZFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyOiBzdHJpbmcpIHtcclxuICAgIHN0ciA9IHN0ci50b0xvY2FsZUxvd2VyQ2FzZSgpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBpZiAoL1teXFxzXFxkLiwjLV0vLnRlc3Qoc3RyLmNoYXJBdChpKSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0ci5zbGljZSgwLCBpKSArIHN0ci5jaGFyQXQoaSkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZShpICsgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0cjtcclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlcyBpbnB1dCBmcm9tIHVzZXIsIGV4cGVjdGluZyBjaGFwdGVyIGFuZCB2ZXJzZXNcclxuICogQHBhcmFtIHVzZXJJbnB1dFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVXNlclZlcnNlSW5wdXQodXNlcklucHV0OiBzdHJpbmcsIHZlcmJvc2UgPSB0cnVlKSB7XHJcbiAgICBsZXQgYm9va0FuZENoYXB0ZXI7XHJcbiAgICBsZXQgYmVnaW5WZXJzZTtcclxuICAgIGxldCBlbmRWZXJzZTtcclxuXHJcbiAgICBzd2l0Y2ggKHRydWUpIHtcclxuICAgICAgICBjYXNlIG9uZVZlcnNlUmVnRXgudGVzdCh1c2VySW5wdXQpOiB7IC8vIG9uZSB2ZXJzZVxyXG4gICAgICAgICAgICBjb25zdCBbLCBtYXRjaGVkQ2hhcHRlciwgbWF0Y2hlZFZlcnNlXSA9IHVzZXJJbnB1dC5tYXRjaChvbmVWZXJzZVJlZ0V4KVxyXG4gICAgICAgICAgICBib29rQW5kQ2hhcHRlciA9IG1hdGNoZWRDaGFwdGVyO1xyXG4gICAgICAgICAgICBiZWdpblZlcnNlID0gTnVtYmVyKG1hdGNoZWRWZXJzZSk7XHJcbiAgICAgICAgICAgIGVuZFZlcnNlID0gTnVtYmVyKG1hdGNoZWRWZXJzZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIG11bHRpcGxlVmVyc2VzUmVnRXgudGVzdCh1c2VySW5wdXQpOiB7IC8vIG11bHRpcGxlIHZlcnNlcywgb25lIGNoYXB0ZXJcclxuICAgICAgICAgICAgY29uc3QgWywgbWF0Y2hlZENoYXB0ZXIsIG1hdGNoZWRCZWdpblZlcnNlLCBtYXRjaGVkRW5kVmVyc2VdID0gdXNlcklucHV0Lm1hdGNoKG11bHRpcGxlVmVyc2VzUmVnRXgpXHJcbiAgICAgICAgICAgIGJvb2tBbmRDaGFwdGVyID0gbWF0Y2hlZENoYXB0ZXI7XHJcbiAgICAgICAgICAgIGJlZ2luVmVyc2UgPSBOdW1iZXIobWF0Y2hlZEJlZ2luVmVyc2UpO1xyXG4gICAgICAgICAgICBlbmRWZXJzZSA9IE51bWJlcihtYXRjaGVkRW5kVmVyc2UpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICBpZiAodmVyYm9zZSkge1xyXG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgV3JvbmcgZm9ybWF0IFwiJHt1c2VySW5wdXR9XCJgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aHJvdyBcIkNvdWxkIG5vdCBwYXJzZSB1c2VyIGlucHV0XCJcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgYm9va0FuZENoYXB0ZXIsIGJlZ2luVmVyc2UsIGVuZFZlcnNlIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFBhcnNlcyBpbnB1dCBmcm9tIHVzZXIsIGV4cGVjdGluZyBtdWx0aXBsZSBjaGFwdGVyc1xyXG4gKiBAcGFyYW0gdXNlcklucHV0XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VVc2VyQm9va0lucHV0KHVzZXJJbnB1dDogc3RyaW5nKSB7XHJcbiAgICBsZXQgYm9vaztcclxuICAgIGxldCBmaXJzdENoYXB0ZXI7XHJcbiAgICBsZXQgbGFzdENoYXB0ZXI7XHJcblxyXG4gICAgc3dpdGNoICh0cnVlKSB7XHJcbiAgICAgICAgY2FzZSBtdWx0aXBsZUNoYXB0ZXJzLnRlc3QodXNlcklucHV0KTogeyAvLyBvbmUgdmVyc2VcclxuICAgICAgICAgICAgY29uc3QgWywgbWF0Y2hlZEJvb2ssIG1hdGNoZWRGaXJzdENoYXB0ZXIsIG1hdGNoZWRMYXN0Q2hhcHRlcl0gPSB1c2VySW5wdXQubWF0Y2gobXVsdGlwbGVDaGFwdGVycylcclxuICAgICAgICAgICAgYm9vayA9IG1hdGNoZWRCb29rLnRyaW0oKTtcclxuICAgICAgICAgICAgZmlyc3RDaGFwdGVyID0gTnVtYmVyKG1hdGNoZWRGaXJzdENoYXB0ZXIpO1xyXG4gICAgICAgICAgICBsYXN0Q2hhcHRlciA9IE51bWJlcihtYXRjaGVkTGFzdENoYXB0ZXIpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICBuZXcgTm90aWNlKGBXcm9uZyBmb3JtYXQgXCIke3VzZXJJbnB1dH1cImApO1xyXG4gICAgICAgICAgICB0aHJvdyBcIkNvdWxkIG5vdCBwYXJzZSB1c2VyIGlucHV0XCJcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHsgYm9vaywgZmlyc3RDaGFwdGVyLCBsYXN0Q2hhcHRlciB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUcmllcyB0byBnZXQgdEZpbGUgY29ycmVzcG9uZGluZyB0byBnaXZlbiBmaWxlbmFtZS4gSWYgdGhlIGZpbGUgaXMgbm90IGZvdW5kLCBmaWxlbmFtZSBpcyBjb252ZXJ0ZWQgdG8gbWF0Y2ggT2JzaWRpYW5cclxuICogQmlibGUgU3R1ZHkgS2l0IG5hbWluZyBjb252ZW50aW9uIGFuZCB0aGUgb3BlcmF0aW9uIGlzIHJlcGVhdGVkLlxyXG4gKiBAcGFyYW0gYXBwXHJcbiAqIEBwYXJhbSBmaWxlbmFtZSBOYW1lIG9mIGZpbGUgdGhhdCBzaG91bGQgYmUgc2VhcmNoZWRcclxuICogQHBhcmFtIHBhdGggUGF0aCB3aGVyZSB0aGUgc2VhcmNoIHNob3VsZCBvY2N1cmVcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWxlQnlGaWxlbmFtZShhcHA6IEFwcCwgZmlsZW5hbWU6IHN0cmluZywgcGF0aCA9IFwiL1wiKSB7XHJcbiAgICBsZXQgZmlsZW5hbWVDb3B5ID0gZmlsZW5hbWU7XHJcbiAgICBsZXQgdEZpbGUgPSBhcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChmaWxlbmFtZUNvcHksIHBhdGgpXHJcbiAgICBpZiAoIXRGaWxlKSB7IC8vIGhhbmRsZSBcIkJpYmxlIHN0dWR5IGtpdFwiIGZpbGUgbmFtaW5nLCBlZy4gR2VuLTAxIGluc3RlYWQgb2YgR2VuIDFcclxuICAgICAgICBmaWxlbmFtZUNvcHkgPSB0cnlDb252ZXJ0VG9PQlNLRmlsZU5hbWUoZmlsZW5hbWVDb3B5KTtcclxuICAgICAgICB0RmlsZSA9IGFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGZpbGVuYW1lQ29weSwgcGF0aCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4geyBmaWxlTmFtZTogZmlsZW5hbWVDb3B5LCB0RmlsZSB9O1xyXG59XHJcblxyXG4vKipcclxuICogVHJpZXMgdG8gY29udmVydCBmaWxlIG5hbWUgdG8gT2JzaWRpYW4gU3R1ZHkgS2l0IGZpbGUgbmFtZVxyXG4gKiBAcGFyYW0gYm9va0FuZENoYXB0ZXIgRmlsZSBuYW1lIHRoYXQgc2hvdWxkIGJlIGNvbnZlcnRlZFxyXG4gKiBAcmV0dXJucyBmaWxlIG5hbWUgaW4gT2JzaWRhaW4gU3R1ZHkgS2l0IG5hbWluZyBzeXN0ZW1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB0cnlDb252ZXJ0VG9PQlNLRmlsZU5hbWUoYm9va0FuZENoYXB0ZXI6IHN0cmluZykge1xyXG4gICAgaWYgKGJvb2tBbmRDaGFwdGVyUmVnZXhGb3JPQlNLLnRlc3QoYm9va0FuZENoYXB0ZXIpKSB7IC8vIFZhbGlkIGNoYXB0ZXIgbmFtZVxyXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcclxuICAgICAgICBsZXQgWywgYm9vaywgbnVtYmVyXSA9IGJvb2tBbmRDaGFwdGVyLm1hdGNoKGJvb2tBbmRDaGFwdGVyUmVnZXhGb3JPQlNLKTtcclxuICAgICAgICBpZiAobnVtYmVyLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgIG51bWJlciA9IGAwJHtudW1iZXJ9YFxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYCR7Ym9va30tJHtudW1iZXJ9YFxyXG4gICAgfVxyXG59XHJcbiIsICJcclxuaW1wb3J0IHsgQXBwLCBNb2RhbCwgU2V0dGluZyB9IGZyb20gXCJvYnNpZGlhblwiO1xyXG5pbXBvcnQgeyBQbHVnaW5TZXR0aW5ncyB9IGZyb20gXCIuLi9tYWluXCI7XHJcbmltcG9ydCB7Y3JlYXRlTGlua3N9IGZyb20gXCIuLi9sb2dpYy9saW5rLWNvbW1hbmRcIjtcclxuXHJcbmV4cG9ydCBlbnVtIExpbmtUeXBlIHtcclxuICAgIEJhc2ljID0gXCJCYXNpY1wiLFxyXG4gICAgRW1iZWRkZWQgPSBcIkVtYmVkZGVkXCIsXHJcbiAgICBJbnZpc2libGUgPSBcIkludmlzaWJsZVwiLFxyXG59XHJcblxyXG4vKipcclxuICogTW9kYWwgdGhhdCBsZXRzIHlvdSBpbnNlcnQgYmlibGUgcmVmZXJlbmNlIGJ5IHVzaW5nIE9ic2lkaWFuIGxpbmtzIFxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGlua1ZlcnNlTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XHJcbiAgICB1c2VySW5wdXQ6IHN0cmluZztcclxuICAgIGxpbmtUeXBlOiBMaW5rVHlwZTtcclxuICAgIHVzZU5ld0xpbmU6IGJvb2xlYW47XHJcbiAgICBvblN1Ym1pdDogKHJlc3VsdDogc3RyaW5nKSA9PiB2b2lkO1xyXG4gICAgcGx1Z2luU2V0dGluZ3M6IFBsdWdpblNldHRpbmdzO1xyXG5cclxuICAgIGhhbmRsZUlucHV0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNyZWF0ZUxpbmtzKHRoaXMuYXBwLCB0aGlzLnVzZXJJbnB1dCwgdGhpcy5saW5rVHlwZSwgdGhpcy51c2VOZXdMaW5lLCB0aGlzLnBsdWdpblNldHRpbmdzKVxyXG5cdFx0XHR0aGlzLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIHRoaXMub25TdWJtaXQocmVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncywgb25TdWJtaXQ6IChyZXN1bHQ6IHN0cmluZykgPT4gdm9pZCkge1xyXG4gICAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgICAgdGhpcy5vblN1Ym1pdCA9IG9uU3VibWl0O1xyXG4gICAgICAgIHRoaXMucGx1Z2luU2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICAgICAgICB0aGlzLmxpbmtUeXBlID0gdGhpcy5wbHVnaW5TZXR0aW5ncy5saW5rVHlwZVByZXNldDtcclxuICAgICAgICB0aGlzLnVzZU5ld0xpbmUgPSB0aGlzLnBsdWdpblNldHRpbmdzLm5ld0xpbmVQcmVzZXQ7XHJcbiAgICB9XHJcblxyXG4gICAgb25PcGVuKCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xyXG5cclxuICAgICAgICAvLyBBZGQgaGVhZGluZyBcclxuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoM1wiLCB7IHRleHQ6IFwiQ3JlYXRlIE9ic2lkaWFuIGxpbmtzIGZyb20gQmlibGUgcmVmZXJlbmNlXCIgfSk7XHJcblxyXG4gICAgICAgIC8vIEFkZCBUZXh0Ym94IGZvciByZWZlcmVuY2VcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiSW5zZXJ0IHJlZmVyZW5jZVwiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4gdGV4dC5vbkNoYW5nZSgodmFsdWUpID0+IHsgdGhpcy51c2VySW5wdXQgPSB2YWx1ZSB9KVxyXG4gICAgICAgICAgICAgICAgLmlucHV0RWwuZm9jdXMoKSk7IC8vIFNldHMgZm9jdXMgdG8gaW5wdXQgZmllbGRcclxuXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJMaW5rIHR5cGVcIilcclxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKExpbmtUeXBlLkJhc2ljLCBMaW5rVHlwZS5CYXNpYylcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihMaW5rVHlwZS5FbWJlZGRlZCwgTGlua1R5cGUuRW1iZWRkZWQpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oTGlua1R5cGUuSW52aXNpYmxlLCBMaW5rVHlwZS5JbnZpc2libGUpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5vbkNoYW5nZSgodmFsdWUpID0+IHRoaXMubGlua1R5cGUgPSB2YWx1ZSBhcyBMaW5rVHlwZSlcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luU2V0dGluZ3MubGlua1R5cGVQcmVzZXQpXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJFYWNoIGxpbmsgb24gbmV3IGxpbmU/XCIpXHJcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRnbCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGdsLnNldFZhbHVlKHRoaXMucGx1Z2luU2V0dGluZ3MubmV3TGluZVByZXNldClcclxuICAgICAgICAgICAgICAgIHRnbC5vbkNoYW5nZSh2YWwgPT4gdGhpcy51c2VOZXdMaW5lID0gdmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcblxyXG5cclxuICAgICAgICAvLyBBZGQgYnV0dG9uIGZvciBzdWJtaXQvZXhpdFxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcclxuICAgICAgICAgICAgLmFkZEJ1dHRvbigoYnRuKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBidG5cclxuICAgICAgICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dChcIkxpbmtcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0Q3RhKClcclxuICAgICAgICAgICAgICAgICAgICAub25DbGljayh0aGlzLmhhbmRsZUlucHV0KVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQWxsb3cgdXNlciB0byBleGl0IHVzaW5nIEVudGVyIGtleVxyXG4gICAgICAgIGNvbnRlbnRFbC5vbmtleWRvd24gPSAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gXCJFbnRlclwiKSB7XHJcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVJbnB1dCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uQ2xvc2UoKSB7XHJcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XHJcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbiIsICJpbXBvcnQge0FwcCwgTm90aWNlfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHtMaW5rVHlwZX0gZnJvbSBcIi4uL21vZGFscy9saW5rLXZlcnNlLW1vZGFsXCI7XHJcbmltcG9ydCB7UGx1Z2luU2V0dGluZ3N9IGZyb20gXCIuLi9tYWluXCI7XHJcbmltcG9ydCB7bXVsdGlwbGVDaGFwdGVyc30gZnJvbSBcIi4uL3V0aWxzL3JlZ2V4ZXNcIjtcclxuaW1wb3J0IHtjYXBpdGFsaXplLCBnZXRGaWxlQnlGaWxlbmFtZSwgcGFyc2VVc2VyQm9va0lucHV0LCBwYXJzZVVzZXJWZXJzZUlucHV0fSBmcm9tIFwiLi9jb21tb25cIjtcclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0cyBiaWJsaWNhbCByZWZlcmVuY2UgdG8gbGlua3MgdG8gZ2l2ZW4gdmVyc2VzIG9yIGJvb2tzXHJcbiAqIEBwYXJhbSBhcHAgQXBwIGluc3RhbmNlXHJcbiAqIEBwYXJhbSB1c2VySW5wdXQgVXNlciBJbnB1dCAobGluayB0byB2ZXJzZSBvciBjaGFwdGVyKVxyXG4gKiBAcGFyYW0gbGlua1R5cGUgVHlwZSBvZiBsaW5rIHRoYXQgc2hvdWxkIGJlIHVzZWRcclxuICogQHBhcmFtIHVzZU5ld0xpbmUgV2hldGhlciBvciBub3Qgc2hvdWxkIGVhY2ggbGluayBiZSBvbiBuZXcgbGluZVxyXG4gKiBAcmV0dXJucyBTdHJpbmcgd2l0aCBxdW90ZSBvZiBsaW5rZWQgdmVyc2VzLiBJZiBjb252ZXJ0aW5nIHdhcyBub3Qgc3VjY2Vzc2Z1bCwgcmV0dXJucyBlbXB0eSBzdHJpbmcuXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTGlua3MoYXBwOiBBcHAsIHVzZXJJbnB1dDogc3RyaW5nLCBsaW5rVHlwZTogTGlua1R5cGUsIHVzZU5ld0xpbmU6IGJvb2xlYW4sIHNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncykge1xyXG5cdGlmIChtdWx0aXBsZUNoYXB0ZXJzLnRlc3QodXNlcklucHV0KSkge1xyXG5cdFx0cmV0dXJuIGdldExpbmtzRm9yQ2hhcHRlcnMoYXBwLCB1c2VySW5wdXQsIGxpbmtUeXBlLCB1c2VOZXdMaW5lLCBzZXR0aW5ncyk7XHJcblx0fSBlbHNlIHtcclxuXHRcdHJldHVybiBnZXRMaW5rc0ZvclZlcnNlcyhhcHAsIHVzZXJJbnB1dCwgbGlua1R5cGUsIHVzZU5ld0xpbmUsIHNldHRpbmdzKTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGNvcHkgY29tbWFuZCBvdXRwdXQgd2hlbiBsaW5raW5nIG11bHRpcGxlIHZlcnNlc1xyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZ2V0TGlua3NGb3JWZXJzZXMoYXBwOiBBcHAsIHVzZXJJbnB1dDogc3RyaW5nLCBsaW5rVHlwZTogTGlua1R5cGUsIHVzZU5ld0xpbmU6IGJvb2xlYW4sIHNldHRpbmdzOiBQbHVnaW5TZXR0aW5ncykge1xyXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItY29uc3RcclxuXHRsZXQge2Jvb2tBbmRDaGFwdGVyLCBiZWdpblZlcnNlLCBlbmRWZXJzZX0gPSBwYXJzZVVzZXJWZXJzZUlucHV0KHVzZXJJbnB1dCk7XHJcblx0Ym9va0FuZENoYXB0ZXIgPSBjYXBpdGFsaXplKGJvb2tBbmRDaGFwdGVyKSAvLyBGb3Igb3V0cHV0IGNvbnNpc3RlbmN5XHJcblx0aWYgKHNldHRpbmdzLnZlcmlmeUZpbGVzV2hlbkxpbmtpbmcpIHtcclxuXHRcdGNvbnN0IHtmaWxlTmFtZSwgdEZpbGV9ID0gZ2V0RmlsZUJ5RmlsZW5hbWUoYXBwLCBib29rQW5kQ2hhcHRlcik7XHJcblx0XHRpZiAoIXRGaWxlKSB7XHJcblx0XHRcdG5ldyBOb3RpY2UoYEZpbGUgXCIke2ZpbGVOYW1lfVwiIGRvZXMgbm90IGV4aXN0IGFuZCB2ZXJpZnkgZmlsZXMgaXMgc2V0IHRvIHRydWVgKTtcclxuXHRcdFx0dGhyb3cgYEZpbGUgJHtmaWxlTmFtZX0gZG9lcyBub3QgZXhpc3QsIHZlcmlmeSBmaWxlcyA9IHRydWVgO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aWYgKGJlZ2luVmVyc2UgPiBlbmRWZXJzZSkge1xyXG5cdFx0bmV3IE5vdGljZShcIkJlZ2luIHZlcnNlIGlzIGJpZ2dlciB0aGFuIGVuZCB2ZXJzZVwiKVxyXG5cdFx0dGhyb3cgXCJCZWdpbiB2ZXJzZSBpcyBiaWdnZXIgdGhhbiBlbmQgdmVyc2VcIlxyXG5cdH1cclxuXHJcblx0bGV0IHJlcyA9IFwiXCI7XHJcblx0Y29uc3QgYmVnaW5uaW5nID0gbGlua1R5cGUgPT09IExpbmtUeXBlLkVtYmVkZGVkID8gXCIhXCIgOiBcIlwiO1xyXG5cdGNvbnN0IGVuZGluZyA9IGxpbmtUeXBlID09PSBMaW5rVHlwZS5JbnZpc2libGUgPyBcInxcIiA6IFwiXCI7XHJcblx0Zm9yIChsZXQgaSA9IGJlZ2luVmVyc2U7IGkgPD0gZW5kVmVyc2U7IGkrKykge1xyXG5cdFx0cmVzICs9IGAke2JlZ2lubmluZ31bWyR7Ym9va0FuZENoYXB0ZXJ9JHtzZXR0aW5ncy5saW5rU2VwYXJhdG9yfSR7c2V0dGluZ3MudmVyc2VQcmVmaXh9JHtpfSR7ZW5kaW5nfV1dYFxyXG5cdFx0aWYgKHVzZU5ld0xpbmUpIHtcclxuXHRcdFx0cmVzICs9ICdcXG4nXHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiByZXM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGVzIGNvcHkgY29tbWFuZCBvdXRwdXQgd2hlbiBsaW5raW5nIG11bHRpcGxlIGNoYXB0ZXJzXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBnZXRMaW5rc0ZvckNoYXB0ZXJzKGFwcDogQXBwLCB1c2VySW5wdXQ6IHN0cmluZywgbGlua1R5cGU6IExpbmtUeXBlLCB1c2VOZXdMaW5lOiBib29sZWFuLCBzZXR0aW5nczogUGx1Z2luU2V0dGluZ3MpIHtcclxuXHRjb25zdCB7Ym9vaywgZmlyc3RDaGFwdGVyLCBsYXN0Q2hhcHRlcn0gPSBwYXJzZVVzZXJCb29rSW5wdXQodXNlcklucHV0KTtcclxuXHRpZiAoZmlyc3RDaGFwdGVyID4gbGFzdENoYXB0ZXIpIHtcclxuXHRcdG5ldyBOb3RpY2UoXCJCZWdpbiBjaGFwdGVyIGlzIGJpZ2dlciB0aGFuIGVuZCBjaGFwdGVyXCIpXHJcblx0XHR0aHJvdyBcIkJlZ2luIGNoYXB0ZXIgaXMgYmlnZ2VyIHRoYW4gZW5kIGNoYXB0ZXJcIlxyXG5cdH1cclxuXHJcblx0bGV0IHJlcyA9IFwiXCI7XHJcblx0Zm9yIChsZXQgaSA9IGZpcnN0Q2hhcHRlcjsgaSA8PSBsYXN0Q2hhcHRlcjsgaSsrKSB7XHJcblx0XHRyZXMgKz0gYFtbJHtib29rfSAke2l9XV1gXHJcblx0XHRpZiAodXNlTmV3TGluZSkge1xyXG5cdFx0XHRyZXMgKz0gJ1xcbidcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIHJlcztcclxufVxyXG4iLCAiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IEJpYmxlTGlua2VyUGx1Z2luIGZyb20gXCIuL21haW5cIjtcclxuaW1wb3J0IHsgTGlua1R5cGUgfSBmcm9tIFwiLi9tb2RhbHMvbGluay12ZXJzZS1tb2RhbFwiO1xyXG5cclxuLyoqXHJcbiAqIFNldHRpbmdzIGZvciBwbHVnaW5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBTZXR0aW5nc1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xyXG4gICAgcGx1Z2luOiBCaWJsZUxpbmtlclBsdWdpbjtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBCaWJsZUxpbmtlclBsdWdpbikge1xyXG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICAgIH1cclxuXHJcbiAgICBkaXNwbGF5KCkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIkNvcHkgYW5kIExpbmsgQmlibGUgdmVyc2VzIGNvbW1hbmRcIiB9KTtcclxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJGdW5jdGlvbmFsXCIgfSk7XHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIlZlcnNlIG9mZnNldFwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYygnQ2hhbmdlIHRoaXMgaWYgd3JvbmcgdmVyc2VzIGFyZSBiZWluZyBsaW5rZWQsIGUuZy4geW91IHdhbnQgXCJHZW4gMSwxLTNcIiBidXQgb3V0cHV0IGlzIHRleHQgZnJvbSB2ZXJzZXMgMi00IFx1MjE5MiBzZXQgdGhpcyB0byAtMScpXHJcbiAgICAgICAgICAgIC5zZXRDbGFzcyhcImltcG9ydGFudC1zZXR0aW5nXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KChpbnB1dEJveCkgPT5cclxuICAgICAgICAgICAgICAgIGlucHV0Qm94XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcnNlT2Zmc2V0LnRvU3RyaW5nKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1iZXIgPSBOdW1iZXIucGFyc2VJbnQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT09IFwiLVwiKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNOYU4obnVtYmVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShcIkludmFsaWQgaW5wdXQsIHBsZWFzZSBpbnNlcnQgdmFsaWQgaW50ZWdlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0Qm94LnNldFZhbHVlKFwiXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcnNlT2Zmc2V0ID0gbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIlZlcnNlIGhlYWRpbmcgbGV2ZWxcIilcclxuICAgICAgICAgICAgLnNldERlc2MoJ0lmIHNldCwgb25seSBoZWFkaW5ncyBvZiBzcGVjaWZpZWQgbGV2ZWwgYXJlIGNvbnNpZGVyZWQgdmVyc2VzIChpZiBmaXJzdCBoZWFkaW5nIG9mIHRoaXMgbGV2ZWwgaXMgYWx3YXlzIGEgdmVyc2UsIGFsc28gc2V0IFwiVmVyc2Ugb2Zmc2V0XCIgdG8gLTEpJylcclxuICAgICAgICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKFwiYW55XCIsIFwiYW55XCIpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCI2XCIsIFwiIyMjIyMjXCIpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCI1XCIsIFwiIyMjIyNcIilcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcIjRcIiwgXCIjIyMjXCIpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCIzXCIsIFwiIyMjXCIpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCIyXCIsIFwiIyNcIilcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcIjFcIiwgXCIjXCIpXHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy52ZXJzZUhlYWRpbmdMZXZlbD8udG9TdHJpbmcoKSA/PyBcImFueVwiKVxyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudmVyc2VIZWFkaW5nTGV2ZWwgPSB2YWx1ZSA9PT0gXCJhbnlcIiA/IHVuZGVmaW5lZCA6IE51bWJlcih2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJJbnNlcnRlZCBwcmVmaXhlcy9wb3N0Zml4ZXNcIiB9KTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiTGluZSBwcmVmaXhcIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJTdHJpbmcgaW5zZXJ0ZWQgaW4gZnJvbnQgb2YgZXZlcnkgbGluZSwgZm9yIGV4YW1wbGUgJz4nIGZvciBxdW90ZS4gTm90ZTogSWYgeW91IHNldCAnUHV0IGVhY2ggdmVyc2Ugb24gYSBuZXcgbGluZT8nIHRvIHRydWUsIHRoZSBwcmVmaXggd2lsbCBiZSBpbnNlcnRlZCBpbiBmcm9udCBvZiBldmVyeSBsaW5lLlwiKVxyXG4gICAgICAgICAgICAuc2V0Q2xhc3MoXCJpbXBvcnRhbnQtc2V0dGluZ1wiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgoaW5wdXRCb3gpID0+XHJcbiAgICAgICAgICAgICAgICBpbnB1dEJveFxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIkluc2VydCBwcmVmaXggaGVyZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmaXgpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcmVmaXggPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJMaW5rIHBvc3RmaXhcIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJTdHJpbmcgaW5zZXJ0ZWQgYWZ0ZXIgYmlibGljYWwgbGluaywgeW91IGNhbiB1c2UgXFxcXG4gdG8gaW5zZXJ0IG5ld2xpbmUuXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KChpbnB1dEJveCkgPT5cclxuICAgICAgICAgICAgICAgIGlucHV0Qm94XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiSW5zZXJ0IHBvc3RmaXggaGVyZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wb3N0Zml4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucG9zdGZpeCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkVhY2ggdmVyc2UgcHJlZml4XCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiU3RyaW5nIGluc2VydGVkIGluIGZyb250IG9mIGV2ZXJ5IGNvcGllZCB2ZXJzZS4gWW91IGNhbiB1c2UgXFxcIntufVxcXCIgd2hlcmUgeW91IHdhbnQgbnVtYmVyIG9mIGdpdmVuIHZlcnNlIGluc2VydGVkLCBmb3IgZXhhbXBsZSBcXFwiKip7bn0qKiBcXFwiIHdpbGwgbWFrZSBlYWNoIHZlcnNlIHN0YXJ0IHdpdGggYm9sZCB2ZXJzZSBudW1iZXIuIFlvdSBjYW4gYWxzbyB1c2UgXFxcIntmfVxcXCIgdG8gaW5zZXJ0IG5hbWUgb2YgdGhlIGNvcnJlc3BvbmRpbmcgZmlsZSAoZm9yIGV4YW1wbGUgdG8gY3JlYXRlIG9ic2lkaWFuIGxpbmtzKS4gTGVhdmUgZW1wdHkgZm9yIG5vIHByZWZpeC5cIilcclxuICAgICAgICAgICAgLmFkZFRleHQoKGlucHV0Qm94KSA9PlxyXG4gICAgICAgICAgICAgICAgaW5wdXRCb3hcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJJbnNlcnQgcHJlZml4IGhlcmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZWFjaFZlcnNlUHJlZml4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZWFjaFZlcnNlUHJlZml4ID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuXHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDRcIiwgeyB0ZXh0OiBcIkxpbmtzXCIgfSk7XHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkxpbmsgdG8gbGFzdCB2ZXJzZT9cIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJTaG91bGQgbGFzdCB2ZXJzZSBiZSBsaW5rZWQgaW4gdGhlIHZpc2libGUgbGluayBiZWZvcmUgdGV4dCBvZiB2ZXJzZXM/XCIpXHJcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5rRW5kVmVyc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5rRW5kVmVyc2UgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJBZGQgaW52aXNpYmxlIGxpbmtzP1wiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIkludmlzaWJsZSBsaW5rcyBhcmUgYWRkZWQgdG8gZWFjaCB2ZXJzZSB1c2VkIChzbyB5b3UgY2FuIGZpbmQgdGhlIGNvbm5lY3Rpb25zIGxhdGVyKSwgdGhleSBhcmUgb25seSB2aXNpYmxlIGluIHNvdXJjZSBtb2RlLlwiKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudXNlSW52aXNpYmxlTGlua3MpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy51c2VJbnZpc2libGVMaW5rcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDRcIiwgeyB0ZXh0OiBcIk91dHB1dCBmb3JtYXRcIiB9KTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiUHV0IGVhY2ggdmVyc2Ugb24gYSBuZXcgbGluZT9cIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJFYWNoIHZlcnNlIGlzIGluc2VydGVkIG9uIGEgbmV3IGxpbmUgKHdpdGggTGluayBwcmVmaXgpLlwiKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubmV3TGluZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5uZXdMaW5lcyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkluc2VydCBzcGFjZSBiZXR3ZWVuIHZlcnNlcz9cIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJTaG91bGQgc3BhY2UgYmUgaW5zZXJ0ZWQgYmV0d2VlbiB2ZXJzZXM/IChPbmx5IGFwcGxpZWQgd2hlbiBQdXQgZWFjaCB2ZXJzZSBvbiBhIG5ldyBsaW5lPyBpcyBzZSB0byBmYWxzZS4gVXNlZnVsIGZvciBsYW5ndWFnZXMgc3VjaCBhcyBDaGluZXNlLilcIilcclxuICAgICAgICAgICAgLnNldERpc2FibGVkKCF0aGlzLnBsdWdpbi5zZXR0aW5ncy5uZXdMaW5lcylcclxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgICAgICAgICAgdG9nZ2xlXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmluc2VydFNwYWNlKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaW5zZXJ0U3BhY2UgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoNFwiLCB7IHRleHQ6IFwiTm90YXRpb25cIiB9KTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiT25lIHZlcnNlIG5vdGF0aW9uXCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiVGhpcyBpcyB0aGUgc3ltYm9sIHRoYXQgd2lsbCBiZSB1c2VkIGJldHdlZW4gY2hhcHRlciBudW1iZXIgYW5kIHZlcnNlIG51bWJlciB3aGVuIGNvcHlpbmcgb25lIHZlcnNlLiBGb3IgZXhhbXBsZSBcXFwiLlxcXCIgXHUyMTkyIEdlbiAxLjEuXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KChpbnB1dEJveCkgPT5cclxuICAgICAgICAgICAgICAgIGlucHV0Qm94XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiSW5zZXJ0IG5vdGF0aW9uIHN5bWJvbCBoZXJlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm9uZVZlcnNlTm90YXRpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5vbmVWZXJzZU5vdGF0aW9uID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiTXVsdGlwbGUgdmVyc2VzIG5vdGF0aW9uXCIpXHJcbiAgICAgICAgICAgIC5zZXREZXNjKFwiVGhpcyBpcyB0aGUgc3ltYm9sIHRoYXQgd2lsbCBiZSB1c2VkIGJldHdlZW4gY2hhcHRlciBudW1iZXIgYW5kIHZlcnNlIG51bWJlciB3aGVuIGNvcHlpbmcgbXVsdGlwbGUgdmVyc2VzLiBGb3IgZXhhbXBsZSBcXFwiLFxcXCIgXHUyMTkyIEdlbiAxLDEtMy5cIilcclxuICAgICAgICAgICAgLmFkZFRleHQoKGlucHV0Qm94KSA9PlxyXG4gICAgICAgICAgICAgICAgaW5wdXRCb3hcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJJbnNlcnQgbm90YXRpb24gc3ltYm9sIGhlcmVcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MubXVsdGlwbGVWZXJzZXNOb3RhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm11bHRpcGxlVmVyc2VzTm90YXRpb24gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJNdWx0aXBsZSB0cmFuc2xhdGlvbnNcIiB9KTtcclxuICAgICAgICBjb250YWluZXJFbC5jcmVhdGVFbChcInBcIiwge1xyXG4gICAgICAgICAgICB0ZXh0OiBcIkFzIG9mIHJpZ2h0IG5vdyB0aGlzIGlzIGFuIGV4cGVyaW1lbnRhbCBmZWF0dXJlLiBJZiB5b3UgZW5jb3VudGVyIGFueSBidWdzIG9yIHlvdSBjYW4gbm90IGZpZ3VyZSB0aGluZ3Mgb3V0IGNyZWF0ZSBpc3N1ZSBvbiB0aGUgR2l0SHViIHBhZ2Ugb2YgdGhpcyBwbHVnaW4uXCJcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIkVuYWJsZSBtdWx0aXBsZSB0cmFuc2xhdGlvbnNcIilcclxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgICAgICAgICAgdG9nZ2xlXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZU11bHRpcGxlVHJhbnNsYXRpb25zKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlTXVsdGlwbGVUcmFuc2xhdGlvbnMgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIClcclxuXHJcblxyXG4gICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVNdWx0aXBsZVRyYW5zbGF0aW9ucykge1xyXG4gICAgICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgICAgIC5zZXROYW1lKFwiUGF0aHMgdG8gdHJhbnNsYXRpb25zIHdpdGggdGhlaXIgbmFtZXNcIilcclxuICAgICAgICAgICAgICAgIC5zZXREZXNjKFwiSW5wdXQgZnVsbCBwYXRocyB0byBmb2xkZXJzIGNvbnRhaW5pbmcgQmlibGUgdHJhbnNsYXRpb25zLCBlYWNoIHRybmFzbGF0aW9uIG9uIHNlcGFyYXRlIGxpbmUuIEFuIGV4YW1wbGUgb2Ygb25lIGVudHJ5OiBcXFwiQmlibGUvTklWL1xcXCIuIFRoZSBwbHVnaW4gd2lsbCBzZWFyY2ggZm9yIGNvcnJlc3BvbmRpbmcgQmlibGUgZmlsZXMgdXNpbmcgZ2l2ZW4gcGF0aHMgYXMgc3RhcnRpbmcgcG9pbnRzLiBNYWtlIHN1cmUgdGhlcmUgYXJlIG5vIGR1cGxpY2F0ZSBmaWxlcyBpbiBnaXZlbiBwYXRocywgb3RoZXJ3aXNlIGl0IGlzIGhhcmQgdG8gdGVsbCB3aGF0IHRoZSBvdXRwdXQgd2lsbCBiZS4gVGhlIGZpcnN0IHRyYW5zbGF0aW9uIHdpbGwgYmUgY29uc2lkZXJlZCB5b3VyIG1haW4gdHJhbnNsYXRpb24uXCIpLmFkZFRleHRBcmVhKChpbnB1dEJveCkgPT5cclxuICAgICAgICAgICAgICAgICAgICBpbnB1dEJveFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJCaWJsZS9OSVYvXFxuQmlibGUvRVNWL1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudHJhbnNsYXRpb25zUGF0aHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0UGF0aHMgPSB2YWx1ZS5zcGxpdCgvXFxyP1xcbnxcXHIvKTsgLy8gc3BsaXQgdXNlciBpbnB1dCBieSBsaW5lcyAocmVnZXggdGFrZXMgaW50byBhY2NvdW50IGFsbCBwb3NzaWJsZSBsaW5lIGVuZGluZ3MpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXRoczogc3RyaW5nW10gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0UGF0aHMuZm9yRWFjaCgocGF0aCkgPT4geyAvLyBwYXJzZSB1c2VyIGlucHV0IGZvciBsYXRlciB1c2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGF0aC5hdCgtMSkgIT09IFwiL1wiKSB7IC8vIEFkZCBwb3RlbnRpb25hbGx5IG1pc3NpbmcgJy8nIHRvIHBhdGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMucHVzaChwYXRoICsgXCIvXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMucHVzaChwYXRoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50cmFuc2xhdGlvbnNQYXRocyA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucGFyc2VkVHJhbnNsYXRpb25QYXRocyA9IHBhdGhzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICApXHJcblxyXG5cclxuICAgICAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgICAgICAuc2V0TmFtZShcIldoYXQgdG8gbGlua1wiKVxyXG4gICAgICAgICAgICAgICAgLnNldERlc2MoXCJDaG9vc2Ugd2hhdCB0cmFuc2xhdGlvbnMgc2hvdWxkIGJlIGxpbmtlZCB3aGVuIGNvcHlpbmcgYSB2ZXJzZS5cIilcclxuICAgICAgICAgICAgICAgIC5hZGREcm9wZG93bigoZHJvcGRvd24pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJhbGxcIiwgXCJMaW5rIHRvIGFsbCB0cmFuc2xhdGlvbnNcIilcclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJ1c2VkXCIsIFwiTGluayBvbmx5IHRvIHVzZWQgdHJhbnNsYXRpb25cIilcclxuICAgICAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oXCJ1c2VkQW5kTWFpblwiLCBcIkxpbmsgdG8gdXNlZCBhbmQgbWFpbiB0cmFuc2xhdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihcIm1haW5cIiwgXCJMaW5rIG9ubHkgdG8gbWFpbiB0cmFuc2xhdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0aW9uTGlua2luZ1R5cGUpXHJcbiAgICAgICAgICAgICAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRyYW5zbGF0aW9uTGlua2luZ1R5cGUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy8gTElOSyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIkxpbmsgQmlibGUgdmVyc2VzIGNvbW1hbmRcIiB9KTtcclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoNFwiLCB7IHRleHQ6IFwiRmlsZSBmb3JtYXRcIiB9KTtcclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJMaW5rIHNlcGFyYXRvclwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlRoaXMgaXMgdGhlIHNlcGFyYXRvciB0aGF0IHdpbGwgYmUgdXNlZCB3aGVuIGxpbmtpbmcsIGUuZy4gaWYgeW91IGVudGVyICcjJyBoZXJlLCBvdXRwdXQgd2lsbCBiZSBbW0dlbiAxIzFdXS4gSWYgeW91IGFyZSB1c2luZyBoZWFkaW5ncyB0byBtYXJrIHZlcnNlcywgdXNlICcjJy4gSWYgeW91IGFyZSB1c2luZyBibG9jayByZWZlcmVuY2VzLCB1c2UgJ14nLlwiKVxyXG4gICAgICAgICAgICAuc2V0Q2xhc3MoXCJpbXBvcnRhbnQtc2V0dGluZ1wiKVxyXG4gICAgICAgICAgICAuYWRkVGV4dCgoaW5wdXRCb3gpID0+XHJcbiAgICAgICAgICAgICAgICBpbnB1dEJveFxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihcIkluc2VydCBzZXBhcmF0b3IgaGVyZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5saW5rU2VwYXJhdG9yKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGlua1NlcGFyYXRvciA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG5cclxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcclxuICAgICAgICAgICAgLnNldE5hbWUoXCJWZXJzZSBwcmVmaXhcIilcclxuICAgICAgICAgICAgLnNldERlc2MoJ0ZpbGwgdGhpcyBpZiB5b3UgYXJlIHVzaW5nIHZlcnNlIHByZWZpeGVzIGluIHlvdXIgYmlibGUgZmlsZXMsIGUuZy4geW91IGhhdmUgXCJ2MVwiIGluIHlvdXIgZmlsZSBcdTIxOTIgc2V0IHRvIFwidlwiLicpXHJcbiAgICAgICAgICAgIC5zZXRDbGFzcyhcImltcG9ydGFudC1zZXR0aW5nXCIpXHJcbiAgICAgICAgICAgIC5hZGRUZXh0KChpbnB1dEJveCkgPT5cclxuICAgICAgICAgICAgICAgIGlucHV0Qm94XHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiSW5zZXJ0IHByZWZpeCBoZXJlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcnNlUHJlZml4KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudmVyc2VQcmVmaXggPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuXHJcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoNFwiLCB7IHRleHQ6IFwiRGVmYXVsdHNcIiB9KTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiTGluayB0eXBlIGRlZmF1bHQgdmFsdWVcIilcclxuICAgICAgICAgICAgLnNldERlc2MoXCJWYWx1ZSB0aGF0IHdpbGwgYmUgc2VsZWN0ZWQgYnkgZGVmYXVsdCBpbiBsaW5rIG1vZGFsLlwiKVxyXG4gICAgICAgICAgICAuYWRkRHJvcGRvd24oKGRyb3Bkb3duKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24oTGlua1R5cGUuQmFzaWMsIExpbmtUeXBlLkJhc2ljKVxyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24uYWRkT3B0aW9uKExpbmtUeXBlLkVtYmVkZGVkLCBMaW5rVHlwZS5FbWJlZGRlZClcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLmFkZE9wdGlvbihMaW5rVHlwZS5JbnZpc2libGUsIExpbmtUeXBlLkludmlzaWJsZSlcclxuICAgICAgICAgICAgICAgIGRyb3Bkb3duLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmxpbmtUeXBlUHJlc2V0KVxyXG4gICAgICAgICAgICAgICAgZHJvcGRvd24ub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubGlua1R5cGVQcmVzZXQgPSB2YWx1ZSBhcyBMaW5rVHlwZTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG4gICAgICAgICAgICAuc2V0TmFtZShcIlVzZSBuZXcgbGluZXMgZGVmYXVsdCB2YWx1ZVwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlZhbHVlIHRoYXQgd2lsbCBiZSBzZWxlY3RlZCBieSBkZWZhdWx0IGluIGxpbmsgbW9kYWwuXCIpXHJcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cclxuICAgICAgICAgICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5uZXdMaW5lUHJlc2V0KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MubmV3TGluZVByZXNldCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDRcIiwgeyB0ZXh0OiBcIk1pc2NcIiB9KTtcclxuXHJcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgICAgICAgIC5zZXROYW1lKFwiVmVyaWZ5IGZpbGVzP1wiKVxyXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlZlcmlmeSBleGlzdGVuY2Ugb2YgZmlsZXMgeW91IGFyZSB0cnlpbmcgdG8gbGluaywgc28gdGhhdCB5b3UgYXJlIG5vdCBpbnNlcnRpbmcgd3JvbmcgcmVmZXJlbmNlcyBieSBtaXN0YWtlLlwiKVxyXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+XHJcbiAgICAgICAgICAgICAgICB0b2dnbGVcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MudmVyaWZ5RmlsZXNXaGVuTGlua2luZylcclxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnZlcmlmeUZpbGVzV2hlbkxpbmtpbmcgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgKVxyXG5cclxuXHJcbiAgICB9XHJcbn1cclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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
